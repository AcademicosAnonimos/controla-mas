"use strict";(()=>{var e={};e.id=572,e.ids=[572],e.modules={517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},8678:e=>{e.exports=import("pg")},8925:(e,r,o)=>{o.a(e,async(e,a)=>{try{o.r(r),o.d(r,{headerHooks:()=>p,originalPathname:()=>_,requestAsyncStorage:()=>c,routeModule:()=>u,serverHooks:()=>l,staticGenerationAsyncStorage:()=>d,staticGenerationBailout:()=>E});var t=o(884),s=o(6132),i=o(786),n=e([i]);i=(n.then?(await n)():n)[0];let u=new t.AppRouteRouteModule({definition:{kind:s.x.APP_ROUTE,page:"/api/ingresos/route",pathname:"/api/ingresos",filename:"route",bundlePath:"app/api/ingresos/route"},resolvedPagePath:"C:\\Users\\User\\Documents\\PROYECTOS\\BASE DE DATOS - Facultad\\ProbandoReact\\ControlaMas\\app\\api\\ingresos\\route.ts",nextConfigOutput:"",userland:i}),{requestAsyncStorage:c,staticGenerationAsyncStorage:d,serverHooks:l,headerHooks:p,staticGenerationBailout:E}=u,_="/api/ingresos/route";a()}catch(e){a(e)}})},786:(e,r,o)=>{o.a(e,async(e,a)=>{try{o.r(r),o.d(r,{GET:()=>GET,POST:()=>POST,dynamic:()=>n});var t=o(5798),s=o(8818),i=e([s]);s=(i.then?(await i)():i)[0];let n="force-dynamic";async function GET(e){try{let{searchParams:r}=new URL(e.url),o=r.get("id_usuario"),a=`
      SELECT i.*, u.nombre as usuario_nombre
      FROM Ingreso i
      JOIN Usuario u ON i.id_usuario = u.id_usuario
    `,i=[];o&&(a+=" WHERE i.id_usuario = $1",i.push(o)),a+=" ORDER BY i.fecha_ingreso DESC";let n=await s.Z.query(a,i);return t.Z.json(n.rows)}catch(e){return t.Z.json({error:"Error al obtener ingresos"},{status:500})}}async function POST(e){let r=await s.Z.connect();try{await r.query("BEGIN");let{descripcion:o,fecha_ingreso:a,monto:s,id_usuario:i}=await e.json();if(!o||!a||!s||!i)throw Error("Todos los campos son requeridos");if(s<=0)throw Error("El monto debe ser mayor a 0");let n=await r.query(`INSERT INTO Ingreso (descripcion, fecha_ingreso, monto, id_usuario) 
       VALUES ($1, $2, $3, $4) RETURNING *`,[o,a,s,i]);return await r.query("UPDATE Usuario SET monto_disponible = monto_disponible + $1 WHERE id_usuario = $2",[s,i]),await r.query("COMMIT"),t.Z.json(n.rows[0])}catch(e){return await r.query("ROLLBACK"),t.Z.json({error:e instanceof Error?e.message:"Error al crear ingreso"},{status:500})}finally{r.release()}}a()}catch(e){a(e)}})},8818:(e,r,o)=>{o.a(e,async(e,a)=>{try{o.d(r,{Z:()=>n});var t=o(8678),s=e([t]);t=(s.then?(await s)():s)[0];let i=new t.Pool({connectionString:process.env.DATABASE_URL,ssl:{rejectUnauthorized:!1}}),n=i;a()}catch(e){a(e)}})}};var r=require("../../../webpack-runtime.js");r.C(e);var __webpack_exec__=e=>r(r.s=e),o=r.X(0,[997],()=>__webpack_exec__(8925));module.exports=o})();