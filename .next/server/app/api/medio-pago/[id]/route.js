"use strict";(()=>{var e={};e.id=465,e.ids=[465],e.modules={517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},8678:e=>{e.exports=import("pg")},8606:(e,o,r)=>{r.a(e,async(e,a)=>{try{r.r(o),r.d(o,{headerHooks:()=>m,originalPathname:()=>g,requestAsyncStorage:()=>p,routeModule:()=>d,serverHooks:()=>c,staticGenerationAsyncStorage:()=>u,staticGenerationBailout:()=>E});var t=r(884),i=r(6132),n=r(8748),s=e([n]);n=(s.then?(await s)():s)[0];let d=new t.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/medio-pago/[id]/route",pathname:"/api/medio-pago/[id]",filename:"route",bundlePath:"app/api/medio-pago/[id]/route"},resolvedPagePath:"C:\\Users\\User\\Documents\\PROYECTOS\\BASE DE DATOS - Facultad\\ProbandoReact\\ControlaMas\\app\\api\\medio-pago\\[id]\\route.ts",nextConfigOutput:"",userland:n}),{requestAsyncStorage:p,staticGenerationAsyncStorage:u,serverHooks:c,headerHooks:m,staticGenerationBailout:E}=d,g="/api/medio-pago/[id]/route";a()}catch(e){a(e)}})},8748:(e,o,r)=>{r.a(e,async(e,a)=>{try{r.r(o),r.d(o,{DELETE:()=>DELETE,PUT:()=>PUT,dynamic:()=>s});var t=r(5798),i=r(8818),n=e([i]);i=(n.then?(await n)():n)[0];let s="force-dynamic";async function PUT(e,{params:o}){try{let{medio_pago:r}=await e.json();if(!r||!r.trim())return t.Z.json({error:"El nombre del medio de pago es requerido"},{status:400});let a=r.trim().toLowerCase(),n=await i.Z.query("SELECT id_medio_pago FROM Medio_pago WHERE LOWER(medio_pago) = LOWER($1) AND id_medio_pago != $2",[a,o.id]);if(n.rows.length>0)return t.Z.json({error:"Ya existe otro medio de pago con ese nombre",medioExistente:n.rows[0]},{status:400});let s=await i.Z.query("UPDATE Medio_pago SET medio_pago = $1 WHERE id_medio_pago = $2 RETURNING *",[r.trim(),o.id]);if(0===s.rows.length)return t.Z.json({error:"Medio de pago no encontrado"},{status:404});return t.Z.json(s.rows[0])}catch(e){if(console.error("Error en PUT /api/medio-pago/[id]:",e),"23505"===e.code)return t.Z.json({error:"Ya existe un medio de pago con ese nombre (constraint)"},{status:400});return t.Z.json({error:"Error al actualizar medio de pago"},{status:500})}}async function DELETE(e,{params:o}){try{let e=await i.Z.query("SELECT 1 FROM Pagosxmedio_pago WHERE id_medio_pago = $1 LIMIT 1",[o.id]);if(e.rows.length>0)return t.Z.json({error:"No se puede eliminar el medio de pago porque tiene pagos asociados"},{status:400});let r=await i.Z.query("SELECT 1 FROM Impacta WHERE id_medio_pago = $1 LIMIT 1",[o.id]);if(r.rows.length>0)return t.Z.json({error:"No se puede eliminar el medio de pago porque tiene impactos asociados"},{status:400});let a=await i.Z.query("DELETE FROM Medio_pago WHERE id_medio_pago = $1 RETURNING *",[o.id]);if(0===a.rows.length)return t.Z.json({error:"Medio de pago no encontrado"},{status:404});return t.Z.json({message:"Medio de pago eliminado correctamente",medioEliminado:a.rows[0]})}catch(e){return console.error("Error en DELETE /api/medio-pago/[id]:",e),t.Z.json({error:"Error al eliminar medio de pago"},{status:500})}}a()}catch(e){a(e)}})},8818:(e,o,r)=>{r.a(e,async(e,a)=>{try{r.d(o,{Z:()=>s});var t=r(8678),i=e([t]);t=(i.then?(await i)():i)[0];let n=new t.Pool({connectionString:process.env.DATABASE_URL,ssl:{rejectUnauthorized:!1}}),s=n;a()}catch(e){a(e)}})}};var o=require("../../../../webpack-runtime.js");o.C(e);var __webpack_exec__=e=>o(o.s=e),r=o.X(0,[997],()=>__webpack_exec__(8606));module.exports=r})();