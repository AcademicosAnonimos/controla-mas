"use strict";(()=>{var t={};t.id=404,t.ids=[404],t.modules={517:t=>{t.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},8678:t=>{t.exports=import("pg")},7259:(t,o,a)=>{a.a(t,async(t,r)=>{try{a.r(o),a.d(o,{headerHooks:()=>l,originalPathname:()=>g,requestAsyncStorage:()=>d,routeModule:()=>u,serverHooks:()=>E,staticGenerationAsyncStorage:()=>c,staticGenerationBailout:()=>_});var e=a(884),i=a(6132),s=a(3095),n=t([s]);s=(n.then?(await n)():n)[0];let u=new e.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/gastos/[id]/route",pathname:"/api/gastos/[id]",filename:"route",bundlePath:"app/api/gastos/[id]/route"},resolvedPagePath:"C:\\Users\\User\\Documents\\PROYECTOS\\BASE DE DATOS - Facultad\\ProbandoReact\\ControlaMas\\app\\api\\gastos\\[id]\\route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:d,staticGenerationAsyncStorage:c,serverHooks:E,headerHooks:l,staticGenerationBailout:_}=u,g="/api/gastos/[id]/route";r()}catch(t){r(t)}})},3095:(t,o,a)=>{a.a(t,async(t,r)=>{try{a.r(o),a.d(o,{DELETE:()=>DELETE,GET:()=>GET,PUT:()=>PUT,dynamic:()=>n});var e=a(5798),i=a(8818),s=t([i]);i=(s.then?(await s)():s)[0];let n="force-dynamic";async function GET(t,{params:o}){try{let t=await i.Z.query(`SELECT g.*, tg.descripcion as tipo_gasto, c.categoria
       FROM Gasto g
       JOIN Tipo_gasto tg ON g.id_tipo_gasto = tg.id_tipo_gasto
       JOIN Categoria c ON g.id_categoria = c.id_categoria
       WHERE g.id_gasto = $1`,[o.id]);if(0===t.rows.length)return e.Z.json({error:"Gasto no encontrado"},{status:404});return e.Z.json(t.rows[0])}catch(t){return e.Z.json({error:"Error al obtener gasto"},{status:500})}}async function PUT(t,{params:o}){let a=await i.Z.connect();try{await a.query("BEGIN");let{mes:r,aÃ±o:i,monto_total:s,descripcion:n,id_tipo_gasto:u,id_categoria:d,id_usuario:c}=await t.json(),E=await a.query("SELECT monto_total, id_usuario FROM Gasto WHERE id_gasto = $1",[o.id]);if(0===E.rows.length)throw Error("Gasto no encontrado");let l=E.rows[0].monto_total,_=E.rows[0].id_usuario,g=await a.query(`UPDATE Gasto 
       SET mes = $1, a\xf1o = $2, monto_total = $3, descripcion = $4, 
           id_tipo_gasto = $5, id_categoria = $6, id_usuario = $7 
       WHERE id_gasto = $8 RETURNING *`,[r,i,s,n,u,d,c,o.id]);if(0===g.rows.length)throw Error("Gasto no encontrado");if(_===c){let t=s-l;await a.query("UPDATE Usuario SET monto_disponible = monto_disponible - $1 WHERE id_usuario = $2",[t,c])}else await a.query("UPDATE Usuario SET monto_disponible = monto_disponible + $1 WHERE id_usuario = $2",[l,_]),await a.query("UPDATE Usuario SET monto_disponible = monto_disponible - $1 WHERE id_usuario = $2",[s,c]);return await a.query("COMMIT"),e.Z.json(g.rows[0])}catch(t){return await a.query("ROLLBACK"),e.Z.json({error:t instanceof Error?t.message:"Error al actualizar gasto"},{status:500})}finally{a.release()}}async function DELETE(t,{params:o}){let a=await i.Z.connect();try{await a.query("BEGIN");let t=await a.query("SELECT monto_total, id_usuario FROM Gasto WHERE id_gasto = $1",[o.id]);if(0===t.rows.length)return e.Z.json({error:"Gasto no encontrado"},{status:404});let r=t.rows[0];return await a.query("DELETE FROM Gasto WHERE id_gasto = $1 RETURNING *",[o.id]),await a.query("UPDATE Usuario SET monto_disponible = monto_disponible + $1 WHERE id_usuario = $2",[r.monto_total,r.id_usuario]),await a.query("COMMIT"),e.Z.json({message:"Gasto eliminado correctamente"})}catch(t){return await a.query("ROLLBACK"),e.Z.json({error:"Error al eliminar gasto"},{status:500})}finally{a.release()}}r()}catch(t){r(t)}})},8818:(t,o,a)=>{a.a(t,async(t,r)=>{try{a.d(o,{Z:()=>n});var e=a(8678),i=t([e]);e=(i.then?(await i)():i)[0];let s=new e.Pool({connectionString:process.env.DATABASE_URL,ssl:{rejectUnauthorized:!1}}),n=s;r()}catch(t){r(t)}})}};var o=require("../../../../webpack-runtime.js");o.C(t);var __webpack_exec__=t=>o(o.s=t),a=o.X(0,[997],()=>__webpack_exec__(7259));module.exports=a})();