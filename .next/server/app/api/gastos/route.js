"use strict";(()=>{var t={};t.id=514,t.ids=[514],t.modules={517:t=>{t.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},8678:t=>{t.exports=import("pg")},204:(t,a,e)=>{e.a(t,async(t,o)=>{try{e.r(a),e.d(a,{headerHooks:()=>p,originalPathname:()=>l,requestAsyncStorage:()=>u,routeModule:()=>c,serverHooks:()=>g,staticGenerationAsyncStorage:()=>d,staticGenerationBailout:()=>_});var r=e(884),s=e(6132),i=e(6438),n=t([i]);i=(n.then?(await n)():n)[0];let c=new r.AppRouteRouteModule({definition:{kind:s.x.APP_ROUTE,page:"/api/gastos/route",pathname:"/api/gastos",filename:"route",bundlePath:"app/api/gastos/route"},resolvedPagePath:"C:\\Users\\User\\Documents\\PROYECTOS\\BASE DE DATOS - Facultad\\ProbandoReact\\ControlaMas\\app\\api\\gastos\\route.ts",nextConfigOutput:"",userland:i}),{requestAsyncStorage:u,staticGenerationAsyncStorage:d,serverHooks:g,headerHooks:p,staticGenerationBailout:_}=c,l="/api/gastos/route";o()}catch(t){o(t)}})},6438:(t,a,e)=>{e.a(t,async(t,o)=>{try{e.r(a),e.d(a,{GET:()=>GET,POST:()=>POST,dynamic:()=>n});var r=e(5798),s=e(8818),i=t([s]);s=(i.then?(await i)():i)[0];let n="force-dynamic";async function GET(t){try{let{searchParams:a}=new URL(t.url),e=a.get("id_usuario"),o=`
      SELECT g.*, tg.descripcion as tipo_gasto, cat.categoria
      FROM Gasto g
      JOIN Tipo_gasto tg ON g.id_tipo_gasto = tg.id_tipo_gasto
      JOIN Categoria cat ON g.id_categoria = cat.id_categoria
    `,i=[];e&&(o+=" WHERE g.id_usuario = $1",i.push(e)),o+=" ORDER BY g.a\xf1o DESC, g.mes DESC";let n=await s.Z.query(o,i);return r.Z.json(n.rows)}catch(t){return r.Z.json({error:"Error al obtener gastos"},{status:500})}}async function POST(t){let a=await s.Z.connect();try{await a.query("BEGIN");let{mes:e,a√±o:o,monto_total:s,descripcion:i,id_tipo_gasto:n,id_categoria:c,id_usuario:u,dia_vencimiento:d,total_cuotas:g,fecha_primera_cuota:p}=await t.json(),_=await a.query(`INSERT INTO Gasto (mes, a\xf1o, monto_total, descripcion, id_tipo_gasto, id_categoria, id_usuario) 
       VALUES ($1, $2, $3, $4, $5, $6, $7) RETURNING *`,[e,o,s,i,n,c,u]),l=_.rows[0];if(1===n){if(!d)throw Error("D\xeda de vencimiento requerido para gastos fijos");await a.query("INSERT INTO Vence (id_gasto, id_tipogasto, dia) VALUES ($1, $2, $3)",[l.id_gasto,n,d])}else if(3===n){if(!g||!p)throw Error("Total de cuotas y fecha de primera cuota requeridos para gastos temporales");let t=new Date(p);for(let e=1;e<=g;e++)await a.query(`INSERT INTO Cuota (nro_cuota, total_cuotas, fecha_vencimiento_cuota, id_gasto, id_estado) 
           VALUES ($1, $2, $3, $4, 1)`,[e,g,t.toISOString().split("T")[0],l.id_gasto]),t.setMonth(t.getMonth()+1)}return await a.query("COMMIT"),r.Z.json(l)}catch(t){return await a.query("ROLLBACK"),r.Z.json({error:t instanceof Error?t.message:"Error al crear gasto"},{status:500})}finally{a.release()}}o()}catch(t){o(t)}})},8818:(t,a,e)=>{e.a(t,async(t,o)=>{try{e.d(a,{Z:()=>n});var r=e(8678),s=t([r]);r=(s.then?(await s)():s)[0];let i=new r.Pool({connectionString:process.env.DATABASE_URL,ssl:{rejectUnauthorized:!1}}),n=i;o()}catch(t){o(t)}})}};var a=require("../../../webpack-runtime.js");a.C(t);var __webpack_exec__=t=>a(a.s=t),e=a.X(0,[997],()=>__webpack_exec__(204));module.exports=e})();