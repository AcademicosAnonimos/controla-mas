(()=>{var e={};e.id=699,e.ids=[699],e.modules={5403:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external")},4749:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external")},399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},5528:e=>{"use strict";e.exports=require("next/dist\\client\\components\\action-async-storage.external.js")},1877:e=>{"use strict";e.exports=require("next/dist\\client\\components\\request-async-storage.external.js")},5319:e=>{"use strict";e.exports=require("next/dist\\client\\components\\static-generation-async-storage.external.js")},7310:e=>{"use strict";e.exports=require("url")},4400:(e,a,s)=>{"use strict";s.r(a),s.d(a,{GlobalError:()=>i.a,__next_app__:()=>p,originalPathname:()=>m,pages:()=>c,routeModule:()=>g,tree:()=>d});var t=s(7096),o=s(6132),r=s(7284),i=s.n(r),l=s(2564),n={};for(let e in l)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(n[e]=()=>l[e]);s.d(a,n);let d=["",{children:["pagos",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(s.bind(s,2550)),"C:\\Users\\User\\Documents\\PROYECTOS\\BASE DE DATOS - Facultad\\ProbandoReact\\ControlaMas\\app\\pagos\\page.tsx"]}]},{}]},{layout:[()=>Promise.resolve().then(s.bind(s,5345)),"C:\\Users\\User\\Documents\\PROYECTOS\\BASE DE DATOS - Facultad\\ProbandoReact\\ControlaMas\\app\\layout.tsx"],"not-found":[()=>Promise.resolve().then(s.t.bind(s,9291,23)),"next/dist/client/components/not-found-error"]}],c=["C:\\Users\\User\\Documents\\PROYECTOS\\BASE DE DATOS - Facultad\\ProbandoReact\\ControlaMas\\app\\pagos\\page.tsx"],m="/pagos/page",p={require:s,loadChunk:()=>Promise.resolve()},g=new t.AppPageRouteModule({definition:{kind:o.x.APP_PAGE,page:"/pagos/page",pathname:"/pagos",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:d}})},3948:(e,a,s)=>{Promise.resolve().then(s.bind(s,7772))},7772:(e,a,s)=>{"use strict";s.r(a),s.d(a,{default:()=>PagosPage});var t=s(784),o=s(9885),r=s(7100),i=s(7394);function PagoForm({pago:e,onSuccess:a,onCancel:s}){let[r,i]=(0,o.useState)({importe_a_pagar:0,fecha_pago:new Date().toISOString().split("T")[0],id_gasto:"",medios_pago:[{id_medio_pago:"",importe_pagado:0}],mes_impacto:new Date().getMonth()+1,año_impacto:new Date().getFullYear()}),[l,n]=(0,o.useState)(!1),[d,c]=(0,o.useState)({}),[m,p]=(0,o.useState)([]),[g,h]=(0,o.useState)([]),[x,u]=(0,o.useState)(0);(0,o.useEffect)(()=>{if(cargarDatosIniciales(),e)i({...e,medios_pago:e.medios_pago||[{id_medio_pago:"",importe_pagado:0}]});else{let e=localStorage.getItem("usuarioActual");e&&cargarGastos(e)}},[e]);let cargarDatosIniciales=async()=>{try{let e=await fetch("/api/medio-pago"),a=await e.json();p(a)}catch(e){console.error("Error cargando medios de pago:",e)}},cargarGastos=async e=>{try{let a=await fetch(`/api/gastos?id_usuario=${e}`),s=await a.json();h(s)}catch(e){console.error("Error cargando gastos:",e)}},validateForm=()=>{let e={};r.importe_a_pagar<=0&&(e.importe_a_pagar="Importe debe ser mayor a 0"),r.id_gasto||(e.id_gasto="Gasto es requerido"),r.fecha_pago||(e.fecha_pago="Fecha de pago es requerida");let a=r.medios_pago.reduce((e,a)=>e+(a.importe_pagado||0),0);return a!==r.importe_a_pagar&&(e.medios_pago=`La suma de medios de pago (${a}) no coincide con el importe total (${r.importe_a_pagar})`),u(a),c(e),0===Object.keys(e).length},handleSubmit=async e=>{if(e.preventDefault(),validateForm()){n(!0);try{let e=await fetch("/api/pagos",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)});if(e.ok)a(),alert("Pago registrado correctamente");else{let a=await e.json();alert(a.error)}}catch(e){alert("Error al registrar pago")}finally{n(!1)}}},handleChange=e=>{let{name:a,value:s}=e.target;i(e=>({...e,[a]:a.includes("importe")||a.includes("mes")||a.includes("a\xf1o")?""===s?"":Number(s):s}))},handleMedioChange=(e,a,s)=>{let t=[...r.medios_pago];t[e]={...t[e],[a]:"importe_pagado"===a?Number(s):s},i(e=>({...e,medios_pago:t}))},removeMedioPago=e=>{if(r.medios_pago.length>1){let a=r.medios_pago.filter((a,s)=>s!==e);i(e=>({...e,medios_pago:a}))}},_=r.medios_pago.some(e=>"3"===e.id_medio_pago);return(0,t.jsxs)("form",{onSubmit:handleSubmit,children:[(0,t.jsxs)("div",{className:"row",children:[(0,t.jsxs)("div",{className:"col-md-6 mb-3",children:[(0,t.jsxs)("label",{htmlFor:"id_gasto",className:"form-label",children:["Gasto ",t.jsx("span",{className:"text-danger",children:"*"})]}),(0,t.jsxs)("select",{className:`form-control ${d.id_gasto?"is-invalid":""}`,id:"id_gasto",name:"id_gasto",value:r.id_gasto,onChange:handleChange,required:!0,children:[t.jsx("option",{value:"",children:"Seleccionar gasto"}),g.map(e=>(0,t.jsxs)("option",{value:e.id_gasto,children:[e.descripcion," - ",e.monto_total," (",e.tipo_gasto,")"]},e.id_gasto))]}),d.id_gasto&&t.jsx("div",{className:"invalid-feedback",children:d.id_gasto})]}),(0,t.jsxs)("div",{className:"col-md-6 mb-3",children:[(0,t.jsxs)("label",{htmlFor:"fecha_pago",className:"form-label",children:["Fecha de Pago ",t.jsx("span",{className:"text-danger",children:"*"})]}),t.jsx("input",{type:"date",className:`form-control ${d.fecha_pago?"is-invalid":""}`,id:"fecha_pago",name:"fecha_pago",value:r.fecha_pago,onChange:handleChange,required:!0}),d.fecha_pago&&t.jsx("div",{className:"invalid-feedback",children:d.fecha_pago})]}),(0,t.jsxs)("div",{className:"col-12 mb-3",children:[(0,t.jsxs)("label",{htmlFor:"importe_a_pagar",className:"form-label",children:["Importe a Pagar ",t.jsx("span",{className:"text-danger",children:"*"})]}),t.jsx("input",{type:"number",step:"0.01",className:`form-control ${d.importe_a_pagar?"is-invalid":""}`,id:"importe_a_pagar",name:"importe_a_pagar",value:r.importe_a_pagar,onChange:handleChange,min:"0.01",required:!0}),d.importe_a_pagar&&t.jsx("div",{className:"invalid-feedback",children:d.importe_a_pagar})]}),(0,t.jsxs)("div",{className:"col-12 mb-3",children:[(0,t.jsxs)("div",{className:"d-flex justify-content-between align-items-center mb-3",children:[t.jsx("label",{className:"form-label",children:"Medios de Pago"}),(0,t.jsxs)("button",{type:"button",className:"btn btn-sm btn-outline-primary",onClick:()=>{i(e=>({...e,medios_pago:[...e.medios_pago,{id_medio_pago:"",importe_pagado:0}]}))},children:[t.jsx("i",{className:"fas fa-plus me-1"}),"Agregar Medio"]})]}),r.medios_pago.map((e,a)=>(0,t.jsxs)("div",{className:"row mb-2 align-items-end",children:[(0,t.jsxs)("div",{className:"col-md-6",children:[t.jsx("label",{className:"form-label",children:"Medio"}),(0,t.jsxs)("select",{className:"form-control",value:e.id_medio_pago,onChange:e=>handleMedioChange(a,"id_medio_pago",e.target.value),required:!0,children:[t.jsx("option",{value:"",children:"Seleccionar medio"}),m.map(e=>t.jsx("option",{value:e.id_medio_pago,children:e.medio_pago},e.id_medio_pago))]})]}),(0,t.jsxs)("div",{className:"col-md-4",children:[t.jsx("label",{className:"form-label",children:"Importe"}),t.jsx("input",{type:"number",step:"0.01",className:"form-control",value:e.importe_pagado,onChange:e=>handleMedioChange(a,"importe_pagado",e.target.value),min:"0.01",required:!0})]}),t.jsx("div",{className:"col-md-2",children:r.medios_pago.length>1&&t.jsx("button",{type:"button",className:"btn btn-outline-danger w-100",onClick:()=>removeMedioPago(a),children:t.jsx("i",{className:"fas fa-times"})})})]},a)),d.medios_pago&&t.jsx("div",{className:"text-danger small mt-2",children:d.medios_pago}),t.jsx("div",{className:"mt-2",children:(0,t.jsxs)("small",{className:"text-muted",children:["Total medios: ",x.toFixed(2)," | Importe total: ",r.importe_a_pagar.toFixed(2)," | Diferencia: ",(r.importe_a_pagar-x).toFixed(2)]})})]}),_&&(0,t.jsxs)("div",{className:"col-12 mb-3 p-3 border rounded bg-light",children:[(0,t.jsxs)("h6",{className:"mb-3",children:[t.jsx("i",{className:"fas fa-calendar-alt me-2"}),"Impacto para Tarjeta de Cr\xe9dito"]}),(0,t.jsxs)("div",{className:"row",children:[(0,t.jsxs)("div",{className:"col-md-6",children:[t.jsx("label",{htmlFor:"mes_impacto",className:"form-label",children:"Mes de Impacto"}),t.jsx("select",{className:"form-control",id:"mes_impacto",name:"mes_impacto",value:r.mes_impacto,onChange:handleChange,children:Array.from({length:12},(e,a)=>t.jsx("option",{value:a+1,children:new Date(2e3,a).toLocaleString("es-AR",{month:"long"})},a+1))})]}),(0,t.jsxs)("div",{className:"col-md-6",children:[t.jsx("label",{htmlFor:"a\xf1o_impacto",className:"form-label",children:"A\xf1o de Impacto"}),t.jsx("input",{type:"number",className:"form-control",id:"a\xf1o_impacto",name:"a\xf1o_impacto",value:r.año_impacto,onChange:handleChange,min:"2020",max:"2030"})]})]})]})]}),(0,t.jsxs)("div",{className:"d-flex justify-content-end gap-2 mt-4",children:[t.jsx("button",{type:"button",className:"btn btn-secondary",onClick:s,disabled:l,children:"Cancelar"}),t.jsx("button",{type:"submit",className:"btn btn-primary",disabled:l,children:l?(0,t.jsxs)(t.Fragment,{children:[t.jsx("span",{className:"spinner-border spinner-border-sm me-2"}),"Guardando..."]}):(0,t.jsxs)(t.Fragment,{children:[t.jsx("i",{className:"fas fa-credit-card me-2"}),"Registrar Pago"]})})]})]})}var l=s(4911);function PagosPage(){let[e,a]=(0,o.useState)([]),[s,n]=(0,o.useState)(!1),[d,c]=(0,o.useState)(!0);(0,o.useEffect)(()=>{cargarPagos()},[]);let cargarPagos=async()=>{try{let e=localStorage.getItem("usuarioActual"),s=await fetch(`/api/pagos?id_usuario=${e}`),t=await s.json();a(t)}catch(e){console.error("Error cargando pagos:",e)}finally{c(!1)}},formatCurrency=e=>new Intl.NumberFormat("es-AR",{style:"currency",currency:"ARS"}).format(e),formatDate=e=>new Date(e).toLocaleDateString("es-AR");return(0,t.jsxs)("div",{className:"d-flex",children:[t.jsx(i.Z,{}),(0,t.jsxs)("div",{className:"flex-grow-1",children:[t.jsx(r.Z,{}),(0,t.jsxs)("main",{className:"container-fluid py-4",children:[(0,t.jsxs)("div",{className:"d-flex justify-content-between align-items-center mb-4",children:[(0,t.jsxs)("div",{children:[t.jsx("h1",{className:"h3 mb-0",children:"Gesti\xf3n de Pagos"}),t.jsx("p",{className:"text-muted",children:"Registra y visualiza tus pagos"})]}),(0,t.jsxs)("button",{className:"btn btn-primary",onClick:()=>n(!0),children:[t.jsx("i",{className:"fas fa-plus me-2"}),"Nuevo Pago"]})]}),t.jsx("div",{className:"card",children:t.jsx("div",{className:"card-body",children:d?t.jsx("div",{className:"text-center py-4",children:t.jsx("div",{className:"spinner-border text-primary",role:"status",children:t.jsx("span",{className:"visually-hidden",children:"Cargando..."})})}):t.jsx("div",{className:"table-responsive",children:(0,t.jsxs)("table",{className:"table table-hover",children:[t.jsx("thead",{children:(0,t.jsxs)("tr",{children:[t.jsx("th",{children:"Descripci\xf3n"}),t.jsx("th",{children:"Importe"}),t.jsx("th",{children:"Fecha Pago"}),t.jsx("th",{children:"Medios de Pago"}),t.jsx("th",{children:"Acciones"})]})}),t.jsx("tbody",{children:e.map(e=>(0,t.jsxs)("tr",{children:[t.jsx("td",{children:e.descripcion_gasto}),t.jsx("td",{children:formatCurrency(e.importe_a_pagar)}),t.jsx("td",{children:formatDate(e.fecha_pago)}),t.jsx("td",{children:e.medios_pago&&e.medios_pago.length>0?t.jsx("div",{children:e.medios_pago.map((e,a)=>(0,t.jsxs)("span",{className:"badge bg-light text-dark me-1",children:[e.medio_pago,": ",formatCurrency(e.importe_pagado)]},a))}):t.jsx("span",{className:"text-muted",children:"Sin medios registrados"})}),t.jsx("td",{children:t.jsx("button",{className:"btn btn-outline-primary btn-sm",children:t.jsx("i",{className:"fas fa-eye"})})})]},e.id_pago))})]})})})}),s&&t.jsx("div",{className:"modal fade show d-block",tabIndex:-1,children:t.jsx("div",{className:"modal-dialog modal-lg",children:(0,t.jsxs)("div",{className:"modal-content",children:[(0,t.jsxs)("div",{className:"modal-header",children:[t.jsx("h5",{className:"modal-title",children:"Registrar Nuevo Pago"}),t.jsx("button",{type:"button",className:"btn-close",onClick:()=>n(!1)})]}),t.jsx("div",{className:"modal-body",children:t.jsx(PagoForm,{onSuccess:()=>{n(!1),cargarPagos()},onCancel:()=>n(!1)})})]})})})]}),t.jsx(l.Z,{})]})]})}},2550:(e,a,s)=>{"use strict";s.r(a),s.d(a,{$$typeof:()=>i,__esModule:()=>r,default:()=>n});var t=s(5153);let o=(0,t.createProxy)(String.raw`C:\Users\User\Documents\PROYECTOS\BASE DE DATOS - Facultad\ProbandoReact\ControlaMas\app\pagos\page.tsx`),{__esModule:r,$$typeof:i}=o,l=o.default,n=l}};var a=require("../../webpack-runtime.js");a.C(e);var __webpack_exec__=e=>a(a.s=e),s=a.X(0,[862,879,866,655],()=>__webpack_exec__(4400));module.exports=s})();