(()=>{var e={};e.id=968,e.ids=[968],e.modules={5403:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external")},4749:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external")},399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},5528:e=>{"use strict";e.exports=require("next/dist\\client\\components\\action-async-storage.external.js")},1877:e=>{"use strict";e.exports=require("next/dist\\client\\components\\request-async-storage.external.js")},5319:e=>{"use strict";e.exports=require("next/dist\\client\\components\\static-generation-async-storage.external.js")},7310:e=>{"use strict";e.exports=require("url")},6223:(e,a,s)=>{"use strict";s.r(a),s.d(a,{GlobalError:()=>o.a,__next_app__:()=>u,originalPathname:()=>m,pages:()=>d,routeModule:()=>h,tree:()=>c});var t=s(7096),i=s(6132),r=s(7284),o=s.n(r),n=s(2564),l={};for(let e in n)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(l[e]=()=>n[e]);s.d(a,l);let c=["",{children:["gastos",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(s.bind(s,907)),"C:\\Users\\User\\Documents\\PROYECTOS\\BASE DE DATOS - Facultad\\ProbandoReact\\ControlaMas\\app\\gastos\\page.tsx"]}]},{}]},{layout:[()=>Promise.resolve().then(s.bind(s,5345)),"C:\\Users\\User\\Documents\\PROYECTOS\\BASE DE DATOS - Facultad\\ProbandoReact\\ControlaMas\\app\\layout.tsx"],"not-found":[()=>Promise.resolve().then(s.t.bind(s,9291,23)),"next/dist/client/components/not-found-error"]}],d=["C:\\Users\\User\\Documents\\PROYECTOS\\BASE DE DATOS - Facultad\\ProbandoReact\\ControlaMas\\app\\gastos\\page.tsx"],m="/gastos/page",u={require:s,loadChunk:()=>Promise.resolve()},h=new t.AppPageRouteModule({definition:{kind:i.x.APP_PAGE,page:"/gastos/page",pathname:"/gastos",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:c}})},7944:(e,a,s)=>{Promise.resolve().then(s.bind(s,8025))},8025:(e,a,s)=>{"use strict";s.r(a),s.d(a,{default:()=>GastosPage});var t=s(784),i=s(9885),r=s(7100),o=s(7394);function GastoForm({gasto:e,onSuccess:a,onCancel:s}){let[r,o]=(0,i.useState)({mes:new Date().getMonth()+1,año:new Date().getFullYear(),monto_total:0,descripcion:"",id_tipo_gasto:"",id_categoria:"",id_usuario:0,dia_vencimiento:"",total_cuotas:1,fecha_primera_cuota:new Date().toISOString().split("T")[0]}),[n,l]=(0,i.useState)(!1),[c,d]=(0,i.useState)({}),[m,u]=(0,i.useState)([]),[h,x]=(0,i.useState)([]);(0,i.useEffect)(()=>{if(cargarDatosIniciales(),e)o(e);else{let e=localStorage.getItem("usuarioActual");e&&o(a=>({...a,id_usuario:parseInt(e)}))}},[e]);let cargarDatosIniciales=async()=>{try{let[e,a]=await Promise.all([fetch("/api/tipos-gasto"),fetch("/api/categorias")]),s=await e.json(),t=await a.json();u(s),x(t)}catch(e){console.error("Error cargando datos:",e)}},validateForm=()=>{let e={};if(r.descripcion.trim()||(e.descripcion="Descripci\xf3n requerida"),r.monto_total<=0&&(e.monto_total="Monto debe ser mayor a 0"),r.id_tipo_gasto||(e.id_tipo_gasto="Tipo de gasto requerido"),r.id_categoria||(e.id_categoria="Categor\xeda requerida"),(r.mes<1||r.mes>12)&&(e.mes="Mes inv\xe1lido"),r.año<2e3&&(e.año="A\xf1o inv\xe1lido"),"1"===r.id_tipo_gasto){let a=Number(r.dia_vencimiento);(!a||a<1||a>31)&&(e.dia_vencimiento="D\xeda de vencimiento inv\xe1lido")}else if("3"===r.id_tipo_gasto){let a=Number(r.total_cuotas);(!a||a<1)&&(e.total_cuotas="N\xfamero de cuotas inv\xe1lido"),r.fecha_primera_cuota||(e.fecha_primera_cuota="Fecha de primera cuota requerida")}return d(e),0===Object.keys(e).length},handleSubmit=async s=>{if(s.preventDefault(),validateForm()){l(!0);try{let s=e?`/api/gastos/${e.id_gasto}`:"/api/gastos",t=e?"PUT":"POST",i=await fetch(s,{method:t,headers:{"Content-Type":"application/json"},body:JSON.stringify(r)});if(i.ok)a(),alert(e?"Gasto actualizado":"Gasto creado");else{let e=await i.json();alert(e.error)}}catch(e){alert("Error al guardar gasto")}finally{l(!1)}}},handleChange=e=>{let{name:a,value:s}=e.target;o(e=>({...e,[a]:a.includes("monto")||a.includes("cuotas")||a.includes("dia")||a.includes("mes")||a.includes("a\xf1o")?""===s?"":Number(s):s}))};return(0,t.jsxs)("form",{onSubmit:handleSubmit,children:[(0,t.jsxs)("div",{className:"row",children:[(0,t.jsxs)("div",{className:"col-12 mb-3",children:[(0,t.jsxs)("label",{htmlFor:"descripcion",className:"form-label",children:["Descripci\xf3n ",t.jsx("span",{className:"text-danger",children:"*"})]}),t.jsx("textarea",{className:`form-control ${c.descripcion?"is-invalid":""}`,id:"descripcion",name:"descripcion",value:r.descripcion,onChange:handleChange,rows:3,required:!0}),c.descripcion&&t.jsx("div",{className:"invalid-feedback",children:c.descripcion})]}),(0,t.jsxs)("div",{className:"col-md-6 mb-3",children:[(0,t.jsxs)("label",{htmlFor:"id_tipo_gasto",className:"form-label",children:["Tipo de Gasto ",t.jsx("span",{className:"text-danger",children:"*"})]}),(0,t.jsxs)("select",{className:`form-control ${c.id_tipo_gasto?"is-invalid":""}`,id:"id_tipo_gasto",name:"id_tipo_gasto",value:r.id_tipo_gasto,onChange:handleChange,required:!0,children:[t.jsx("option",{value:"",children:"Seleccionar tipo"}),m.map(e=>t.jsx("option",{value:e.id_tipo_gasto,children:e.descripcion},e.id_tipo_gasto))]}),c.id_tipo_gasto&&t.jsx("div",{className:"invalid-feedback",children:c.id_tipo_gasto})]}),(0,t.jsxs)("div",{className:"col-md-6 mb-3",children:[(0,t.jsxs)("label",{htmlFor:"id_categoria",className:"form-label",children:["Categor\xeda ",t.jsx("span",{className:"text-danger",children:"*"})]}),(0,t.jsxs)("select",{className:`form-control ${c.id_categoria?"is-invalid":""}`,id:"id_categoria",name:"id_categoria",value:r.id_categoria,onChange:handleChange,required:!0,children:[t.jsx("option",{value:"",children:"Seleccionar categor\xeda"}),h.map(e=>t.jsx("option",{value:e.id_categoria,children:e.categoria},e.id_categoria))]}),c.id_categoria&&t.jsx("div",{className:"invalid-feedback",children:c.id_categoria})]}),(0,t.jsxs)("div",{className:"col-md-4 mb-3",children:[(0,t.jsxs)("label",{htmlFor:"monto_total",className:"form-label",children:["Monto Total ",t.jsx("span",{className:"text-danger",children:"*"})]}),t.jsx("input",{type:"number",step:"0.01",className:`form-control ${c.monto_total?"is-invalid":""}`,id:"monto_total",name:"monto_total",value:r.monto_total,onChange:handleChange,min:"0.01",required:!0}),c.monto_total&&t.jsx("div",{className:"invalid-feedback",children:c.monto_total})]}),(0,t.jsxs)("div",{className:"col-md-4 mb-3",children:[(0,t.jsxs)("label",{htmlFor:"mes",className:"form-label",children:["Mes ",t.jsx("span",{className:"text-danger",children:"*"})]}),t.jsx("select",{className:`form-control ${c.mes?"is-invalid":""}`,id:"mes",name:"mes",value:r.mes,onChange:handleChange,required:!0,children:Array.from({length:12},(e,a)=>t.jsx("option",{value:a+1,children:new Date(2e3,a).toLocaleString("es-AR",{month:"long"})},a+1))}),c.mes&&t.jsx("div",{className:"invalid-feedback",children:c.mes})]}),(0,t.jsxs)("div",{className:"col-md-4 mb-3",children:[(0,t.jsxs)("label",{htmlFor:"a\xf1o",className:"form-label",children:["A\xf1o ",t.jsx("span",{className:"text-danger",children:"*"})]}),t.jsx("input",{type:"number",className:`form-control ${c.año?"is-invalid":""}`,id:"a\xf1o",name:"a\xf1o",value:r.año,onChange:handleChange,min:"2000",max:"2100",required:!0}),c.año&&t.jsx("div",{className:"invalid-feedback",children:c.año})]}),(()=>{switch(r.id_tipo_gasto){case"1":return(0,t.jsxs)("div",{className:"col-md-6 mb-3",children:[(0,t.jsxs)("label",{htmlFor:"dia_vencimiento",className:"form-label",children:["D\xeda de Vencimiento ",t.jsx("span",{className:"text-danger",children:"*"})]}),t.jsx("input",{type:"number",className:`form-control ${c.dia_vencimiento?"is-invalid":""}`,id:"dia_vencimiento",name:"dia_vencimiento",value:r.dia_vencimiento,onChange:handleChange,min:"1",max:"31",required:!0}),c.dia_vencimiento&&t.jsx("div",{className:"invalid-feedback",children:c.dia_vencimiento})]});case"3":return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{className:"col-md-6 mb-3",children:[(0,t.jsxs)("label",{htmlFor:"total_cuotas",className:"form-label",children:["Total de Cuotas ",t.jsx("span",{className:"text-danger",children:"*"})]}),t.jsx("input",{type:"number",className:`form-control ${c.total_cuotas?"is-invalid":""}`,id:"total_cuotas",name:"total_cuotas",value:r.total_cuotas,onChange:handleChange,min:"1",required:!0}),c.total_cuotas&&t.jsx("div",{className:"invalid-feedback",children:c.total_cuotas})]}),(0,t.jsxs)("div",{className:"col-md-6 mb-3",children:[(0,t.jsxs)("label",{htmlFor:"fecha_primera_cuota",className:"form-label",children:["Fecha Primera Cuota ",t.jsx("span",{className:"text-danger",children:"*"})]}),t.jsx("input",{type:"date",className:`form-control ${c.fecha_primera_cuota?"is-invalid":""}`,id:"fecha_primera_cuota",name:"fecha_primera_cuota",value:r.fecha_primera_cuota,onChange:handleChange,required:!0}),c.fecha_primera_cuota&&t.jsx("div",{className:"invalid-feedback",children:c.fecha_primera_cuota})]})]});default:return null}})()]}),(0,t.jsxs)("div",{className:"d-flex justify-content-end gap-2 mt-4",children:[t.jsx("button",{type:"button",className:"btn btn-secondary",onClick:s,disabled:n,children:"Cancelar"}),t.jsx("button",{type:"submit",className:"btn btn-primary",disabled:n,children:n?(0,t.jsxs)(t.Fragment,{children:[t.jsx("span",{className:"spinner-border spinner-border-sm me-2"}),"Guardando..."]}):(0,t.jsxs)(t.Fragment,{children:[t.jsx("i",{className:"fas fa-save me-2"}),e?"Actualizar":"Crear"," Gasto"]})})]})]})}var n=s(4911);function GastosPage(){let[e,a]=(0,i.useState)([]),[s,l]=(0,i.useState)(!1),[c,d]=(0,i.useState)(null),[m,u]=(0,i.useState)(!0);(0,i.useEffect)(()=>{cargarGastos()},[]);let cargarGastos=async()=>{try{let e=localStorage.getItem("usuarioActual"),s=await fetch(`/api/gastos?id_usuario=${e}`),t=await s.json();a(t)}catch(e){console.error("Error cargando gastos:",e)}finally{u(!1)}},handleEdit=e=>{d(e),l(!0)},handleDelete=async e=>{if(confirm("\xbfEst\xe1s seguro de eliminar este gasto?"))try{let a=await fetch(`/api/gastos/${e}`,{method:"DELETE"});if(a.ok)cargarGastos(),alert("Gasto eliminado correctamente");else{let e=await a.json();alert(e.error)}}catch(e){alert("Error al eliminar gasto")}},formatCurrency=e=>new Intl.NumberFormat("es-AR",{style:"currency",currency:"ARS"}).format(e);return(0,t.jsxs)("div",{className:"d-flex",children:[t.jsx(o.Z,{}),(0,t.jsxs)("div",{className:"flex-grow-1",children:[t.jsx(r.Z,{}),(0,t.jsxs)("main",{className:"container-fluid py-4",children:[(0,t.jsxs)("div",{className:"d-flex justify-content-between align-items-center mb-4",children:[(0,t.jsxs)("div",{children:[t.jsx("h1",{className:"h3 mb-0",children:"Gesti\xf3n de Gastos"}),t.jsx("p",{className:"text-muted",children:"Administra tus gastos personales"})]}),(0,t.jsxs)("button",{className:"btn btn-primary",onClick:()=>l(!0),children:[t.jsx("i",{className:"fas fa-plus me-2"}),"Nuevo Gasto"]})]}),t.jsx("div",{className:"card",children:t.jsx("div",{className:"card-body",children:m?t.jsx("div",{className:"text-center py-4",children:t.jsx("div",{className:"spinner-border text-primary",role:"status",children:t.jsx("span",{className:"visually-hidden",children:"Cargando..."})})}):t.jsx("div",{className:"table-responsive",children:(0,t.jsxs)("table",{className:"table table-hover",children:[t.jsx("thead",{children:(0,t.jsxs)("tr",{children:[t.jsx("th",{children:"Descripci\xf3n"}),t.jsx("th",{children:"Tipo"}),t.jsx("th",{children:"Categor\xeda"}),t.jsx("th",{children:"Monto"}),t.jsx("th",{children:"Mes/A\xf1o"}),t.jsx("th",{children:"Acciones"})]})}),t.jsx("tbody",{children:e.map(e=>(0,t.jsxs)("tr",{children:[t.jsx("td",{children:e.descripcion}),t.jsx("td",{children:t.jsx("span",{className:`badge ${"Fijo"===e.tipo_gasto?"bg-primary":"Temporal"===e.tipo_gasto?"bg-warning":"Anual"===e.tipo_gasto?"bg-info":"bg-secondary"}`,children:e.tipo_gasto})}),t.jsx("td",{children:e.categoria}),t.jsx("td",{children:formatCurrency(e.monto_total)}),(0,t.jsxs)("td",{children:[e.mes,"/",e.año]}),t.jsx("td",{children:(0,t.jsxs)("div",{className:"btn-group btn-group-sm",children:[t.jsx("button",{className:"btn btn-outline-primary",onClick:()=>handleEdit(e),children:t.jsx("i",{className:"fas fa-edit"})}),t.jsx("button",{className:"btn btn-outline-danger",onClick:()=>handleDelete(e.id_gasto),children:t.jsx("i",{className:"fas fa-trash"})})]})})]},e.id_gasto))})]})})})}),s&&t.jsx("div",{className:"modal fade show d-block",tabIndex:-1,children:t.jsx("div",{className:"modal-dialog modal-lg",children:(0,t.jsxs)("div",{className:"modal-content",children:[(0,t.jsxs)("div",{className:"modal-header",children:[t.jsx("h5",{className:"modal-title",children:c?"Editar Gasto":"Nuevo Gasto"}),t.jsx("button",{type:"button",className:"btn-close",onClick:()=>l(!1)})]}),t.jsx("div",{className:"modal-body",children:t.jsx(GastoForm,{gasto:c,onSuccess:()=>{l(!1),d(null),cargarGastos()},onCancel:()=>l(!1)})})]})})})]}),t.jsx(n.Z,{})]})]})}},907:(e,a,s)=>{"use strict";s.r(a),s.d(a,{$$typeof:()=>o,__esModule:()=>r,default:()=>l});var t=s(5153);let i=(0,t.createProxy)(String.raw`C:\Users\User\Documents\PROYECTOS\BASE DE DATOS - Facultad\ProbandoReact\ControlaMas\app\gastos\page.tsx`),{__esModule:r,$$typeof:o}=i,n=i.default,l=n}};var a=require("../../webpack-runtime.js");a.C(e);var __webpack_exec__=e=>a(a.s=e),s=a.X(0,[862,879,718,655],()=>__webpack_exec__(6223));module.exports=s})();