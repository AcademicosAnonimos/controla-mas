(()=>{var e={};e.id=622,e.ids=[622],e.modules={5403:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external")},4749:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external")},399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},5528:e=>{"use strict";e.exports=require("next/dist\\client\\components\\action-async-storage.external.js")},1877:e=>{"use strict";e.exports=require("next/dist\\client\\components\\request-async-storage.external.js")},5319:e=>{"use strict";e.exports=require("next/dist\\client\\components\\static-generation-async-storage.external.js")},7310:e=>{"use strict";e.exports=require("url")},4527:(e,s,a)=>{"use strict";a.r(s),a.d(s,{GlobalError:()=>i.a,__next_app__:()=>u,originalPathname:()=>m,pages:()=>d,routeModule:()=>h,tree:()=>c});var r=a(7096),n=a(6132),t=a(7284),i=a.n(t),o=a(2564),l={};for(let e in o)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(l[e]=()=>o[e]);a.d(s,l);let c=["",{children:["ingresos",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(a.bind(a,2904)),"C:\\Users\\User\\Documents\\PROYECTOS\\BASE DE DATOS - Facultad\\ProbandoReact\\ControlaMas\\app\\ingresos\\page.tsx"]}]},{}]},{layout:[()=>Promise.resolve().then(a.bind(a,5345)),"C:\\Users\\User\\Documents\\PROYECTOS\\BASE DE DATOS - Facultad\\ProbandoReact\\ControlaMas\\app\\layout.tsx"],"not-found":[()=>Promise.resolve().then(a.t.bind(a,9291,23)),"next/dist/client/components/not-found-error"]}],d=["C:\\Users\\User\\Documents\\PROYECTOS\\BASE DE DATOS - Facultad\\ProbandoReact\\ControlaMas\\app\\ingresos\\page.tsx"],m="/ingresos/page",u={require:a,loadChunk:()=>Promise.resolve()},h=new r.AppPageRouteModule({definition:{kind:n.x.APP_PAGE,page:"/ingresos/page",pathname:"/ingresos",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:c}})},1107:(e,s,a)=>{Promise.resolve().then(a.bind(a,2315))},2315:(e,s,a)=>{"use strict";a.r(s),a.d(s,{default:()=>IngresosPage});var r=a(784),n=a(9885),t=a(7100),i=a(7394);function IngresoForm({ingreso:e,onSuccess:s,onCancel:a}){let[t,i]=(0,n.useState)({descripcion:"",fecha_ingreso:new Date().toISOString().split("T")[0],monto:0,id_usuario:0}),[o,l]=(0,n.useState)(!1),[c,d]=(0,n.useState)({});(0,n.useEffect)(()=>{if(e)i(e);else{let e=localStorage.getItem("usuarioActual");e&&i(s=>({...s,id_usuario:parseInt(e)}))}},[e]);let validateForm=()=>{let e={};return t.descripcion.trim()||(e.descripcion="La descripci\xf3n es requerida"),t.fecha_ingreso||(e.fecha_ingreso="La fecha es requerida"),t.monto<=0&&(e.monto="El monto debe ser mayor a 0"),t.id_usuario||(e.id_usuario="Usuario es requerido"),d(e),0===Object.keys(e).length},handleSubmit=async a=>{if(a.preventDefault(),validateForm()){l(!0);try{let a=e?`/api/ingresos/${e.id_ingreso}`:"/api/ingresos",r=e?"PUT":"POST",n=await fetch(a,{method:r,headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(n.ok)s(),alert(e?"Ingreso actualizado correctamente":"Ingreso creado correctamente");else{let e=await n.json();alert(e.error)}}catch(e){alert("Error al guardar ingreso")}finally{l(!1)}}},handleChange=e=>{let{name:s,value:a}=e.target;i(e=>({...e,[s]:"monto"===s?parseFloat(a)||0:"id_usuario"===s?parseInt(a)||0:a}))};return(0,r.jsxs)("form",{onSubmit:handleSubmit,children:[(0,r.jsxs)("div",{className:"row",children:[(0,r.jsxs)("div",{className:"col-12 mb-3",children:[(0,r.jsxs)("label",{htmlFor:"descripcion",className:"form-label",children:["Descripci\xf3n ",r.jsx("span",{className:"text-danger",children:"*"})]}),r.jsx("textarea",{className:`form-control ${c.descripcion?"is-invalid":""}`,id:"descripcion",name:"descripcion",value:t.descripcion,onChange:handleChange,rows:3,required:!0}),c.descripcion&&r.jsx("div",{className:"invalid-feedback",children:c.descripcion})]}),(0,r.jsxs)("div",{className:"col-md-6 mb-3",children:[(0,r.jsxs)("label",{htmlFor:"fecha_ingreso",className:"form-label",children:["Fecha ",r.jsx("span",{className:"text-danger",children:"*"})]}),r.jsx("input",{type:"date",className:`form-control ${c.fecha_ingreso?"is-invalid":""}`,id:"fecha_ingreso",name:"fecha_ingreso",value:t.fecha_ingreso,onChange:handleChange,required:!0}),c.fecha_ingreso&&r.jsx("div",{className:"invalid-feedback",children:c.fecha_ingreso})]}),(0,r.jsxs)("div",{className:"col-md-6 mb-3",children:[(0,r.jsxs)("label",{htmlFor:"monto",className:"form-label",children:["Monto ",r.jsx("span",{className:"text-danger",children:"*"})]}),r.jsx("input",{type:"number",step:"0.01",className:`form-control ${c.monto?"is-invalid":""}`,id:"monto",name:"monto",value:t.monto,onChange:handleChange,min:"0.01",required:!0}),c.monto&&r.jsx("div",{className:"invalid-feedback",children:c.monto})]})]}),(0,r.jsxs)("div",{className:"d-flex justify-content-end gap-2 mt-4",children:[r.jsx("button",{type:"button",className:"btn btn-secondary",onClick:a,disabled:o,children:"Cancelar"}),r.jsx("button",{type:"submit",className:"btn btn-primary",disabled:o,children:o?(0,r.jsxs)(r.Fragment,{children:[r.jsx("span",{className:"spinner-border spinner-border-sm me-2",role:"status"}),"Guardando..."]}):(0,r.jsxs)(r.Fragment,{children:[r.jsx("i",{className:"fas fa-save me-2"}),e?"Actualizar":"Crear"," Ingreso"]})})]})]})}var o=a(4911);function IngresosPage(){let[e,s]=(0,n.useState)([]),[a,l]=(0,n.useState)(!1),[c,d]=(0,n.useState)(null),[m,u]=(0,n.useState)(!0);(0,n.useEffect)(()=>{cargarIngresos()},[]);let cargarIngresos=async()=>{try{let e=localStorage.getItem("usuarioActual"),a=await fetch(`/api/ingresos?id_usuario=${e}`),r=await a.json();s(r)}catch(e){console.error("Error cargando ingresos:",e)}finally{u(!1)}},handleEdit=e=>{d(e),l(!0)},handleDelete=async e=>{if(confirm("\xbfEst\xe1s seguro de eliminar este ingreso?"))try{let s=await fetch(`/api/ingresos/${e}`,{method:"DELETE"});if(s.ok)cargarIngresos(),alert("Ingreso eliminado correctamente");else{let e=await s.json();alert(e.error)}}catch(e){alert("Error al eliminar ingreso")}},formatCurrency=e=>new Intl.NumberFormat("es-AR",{style:"currency",currency:"ARS"}).format(e),formatDate=e=>new Date(e).toLocaleDateString("es-AR");return(0,r.jsxs)("div",{className:"d-flex",children:[r.jsx(i.Z,{}),(0,r.jsxs)("div",{className:"flex-grow-1",children:[r.jsx(t.Z,{}),(0,r.jsxs)("main",{className:"container-fluid py-4",children:[(0,r.jsxs)("div",{className:"d-flex justify-content-between align-items-center mb-4",children:[(0,r.jsxs)("div",{children:[r.jsx("h1",{className:"h3 mb-0",children:"Gesti\xf3n de Ingresos"}),r.jsx("p",{className:"text-muted",children:"Administra tus ingresos personales"})]}),(0,r.jsxs)("button",{className:"btn btn-primary",onClick:()=>l(!0),children:[r.jsx("i",{className:"fas fa-plus me-2"}),"Nuevo Ingreso"]})]}),r.jsx("div",{className:"card",children:r.jsx("div",{className:"card-body",children:m?r.jsx("div",{className:"text-center py-4",children:r.jsx("div",{className:"spinner-border text-primary",role:"status",children:r.jsx("span",{className:"visually-hidden",children:"Cargando..."})})}):(0,r.jsxs)("div",{className:"table-responsive",children:[(0,r.jsxs)("table",{className:"table table-hover",children:[r.jsx("thead",{children:(0,r.jsxs)("tr",{children:[r.jsx("th",{children:"Descripci\xf3n"}),r.jsx("th",{children:"Fecha"}),r.jsx("th",{children:"Monto"}),r.jsx("th",{children:"Usuario"}),r.jsx("th",{children:"Acciones"})]})}),r.jsx("tbody",{children:e.map(e=>(0,r.jsxs)("tr",{children:[r.jsx("td",{children:e.descripcion}),r.jsx("td",{children:formatDate(e.fecha_ingreso)}),(0,r.jsxs)("td",{className:"text-success fw-bold",children:["+",formatCurrency(e.monto)]}),r.jsx("td",{children:e.usuario_nombre}),r.jsx("td",{children:(0,r.jsxs)("div",{className:"btn-group btn-group-sm",children:[r.jsx("button",{className:"btn btn-outline-primary",onClick:()=>handleEdit(e),children:r.jsx("i",{className:"fas fa-edit"})}),r.jsx("button",{className:"btn btn-outline-danger",onClick:()=>handleDelete(e.id_ingreso),children:r.jsx("i",{className:"fas fa-trash"})})]})})]},e.id_ingreso))})]}),0===e.length&&(0,r.jsxs)("div",{className:"text-center py-5 text-muted",children:[r.jsx("i",{className:"fas fa-money-bill-wave fa-3x mb-3"}),r.jsx("p",{children:"No hay ingresos registrados"}),(0,r.jsxs)("button",{className:"btn btn-primary",onClick:()=>l(!0),children:[r.jsx("i",{className:"fas fa-plus me-2"}),"Registrar Primer Ingreso"]})]})]})})}),a&&r.jsx("div",{className:"modal fade show d-block",tabIndex:-1,children:r.jsx("div",{className:"modal-dialog modal-lg",children:(0,r.jsxs)("div",{className:"modal-content",children:[(0,r.jsxs)("div",{className:"modal-header",children:[r.jsx("h5",{className:"modal-title",children:c?"Editar Ingreso":"Nuevo Ingreso"}),r.jsx("button",{type:"button",className:"btn-close",onClick:()=>l(!1)})]}),r.jsx("div",{className:"modal-body",children:r.jsx(IngresoForm,{ingreso:c,onSuccess:()=>{l(!1),d(null),cargarIngresos()},onCancel:()=>l(!1)})})]})})})]}),r.jsx(o.Z,{})]})]})}},2904:(e,s,a)=>{"use strict";a.r(s),a.d(s,{$$typeof:()=>i,__esModule:()=>t,default:()=>l});var r=a(5153);let n=(0,r.createProxy)(String.raw`C:\Users\User\Documents\PROYECTOS\BASE DE DATOS - Facultad\ProbandoReact\ControlaMas\app\ingresos\page.tsx`),{__esModule:t,$$typeof:i}=n,o=n.default,l=o}};var s=require("../../webpack-runtime.js");s.C(e);var __webpack_exec__=e=>s(s.s=e),a=s.X(0,[862,879,718,655],()=>__webpack_exec__(4527));module.exports=a})();