(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[968],{6160:function(a,e,s){Promise.resolve().then(s.bind(s,7815))},7815:function(a,e,s){"use strict";s.r(e),s.d(e,{default:function(){return GastosPage}});var t=s(7437),i=s(2265),n=s(5220),l=s(6264);function GastoForm(a){let{gasto:e,onSuccess:s,onCancel:n}=a,[l,o]=(0,i.useState)({mes:new Date().getMonth()+1,año:new Date().getFullYear(),monto_total:0,descripcion:"",id_tipo_gasto:"",id_categoria:"",id_usuario:0,dia_vencimiento:"",total_cuotas:1,fecha_primera_cuota:new Date().toISOString().split("T")[0]}),[c,r]=(0,i.useState)(!1),[d,m]=(0,i.useState)({}),[h,u]=(0,i.useState)([]),[x,g]=(0,i.useState)([]);(0,i.useEffect)(()=>{if(cargarDatosIniciales(),e)o(e);else{let a=localStorage.getItem("usuarioActual");a&&o(e=>({...e,id_usuario:parseInt(a)}))}},[e]);let cargarDatosIniciales=async()=>{try{let[a,e]=await Promise.all([fetch("/api/tipos-gasto"),fetch("/api/categorias")]),s=await a.json(),t=await e.json();u(s),g(t)}catch(a){console.error("Error cargando datos:",a)}},validateForm=()=>{let a={};if(l.descripcion.trim()||(a.descripcion="Descripci\xf3n requerida"),l.monto_total<=0&&(a.monto_total="Monto debe ser mayor a 0"),l.id_tipo_gasto||(a.id_tipo_gasto="Tipo de gasto requerido"),l.id_categoria||(a.id_categoria="Categor\xeda requerida"),(l.mes<1||l.mes>12)&&(a.mes="Mes inv\xe1lido"),l.año<2e3&&(a.año="A\xf1o inv\xe1lido"),"1"===l.id_tipo_gasto){let e=Number(l.dia_vencimiento);(!e||e<1||e>31)&&(a.dia_vencimiento="D\xeda de vencimiento inv\xe1lido")}else if("3"===l.id_tipo_gasto){let e=Number(l.total_cuotas);(!e||e<1)&&(a.total_cuotas="N\xfamero de cuotas inv\xe1lido"),l.fecha_primera_cuota||(a.fecha_primera_cuota="Fecha de primera cuota requerida")}return m(a),0===Object.keys(a).length},handleSubmit=async a=>{if(a.preventDefault(),validateForm()){r(!0);try{let a=e?"/api/gastos/".concat(e.id_gasto):"/api/gastos",t=e?"PUT":"POST",i=await fetch(a,{method:t,headers:{"Content-Type":"application/json"},body:JSON.stringify(l)});if(i.ok)s(),alert(e?"Gasto actualizado":"Gasto creado");else{let a=await i.json();alert(a.error)}}catch(a){alert("Error al guardar gasto")}finally{r(!1)}}},handleChange=a=>{let{name:e,value:s}=a.target;o(a=>({...a,[e]:e.includes("monto")||e.includes("cuotas")||e.includes("dia")||e.includes("mes")||e.includes("a\xf1o")?""===s?"":Number(s):s}))};return(0,t.jsxs)("form",{onSubmit:handleSubmit,children:[(0,t.jsxs)("div",{className:"row",children:[(0,t.jsxs)("div",{className:"col-12 mb-3",children:[(0,t.jsxs)("label",{htmlFor:"descripcion",className:"form-label",children:["Descripci\xf3n ",(0,t.jsx)("span",{className:"text-danger",children:"*"})]}),(0,t.jsx)("textarea",{className:"form-control ".concat(d.descripcion?"is-invalid":""),id:"descripcion",name:"descripcion",value:l.descripcion,onChange:handleChange,rows:3,required:!0}),d.descripcion&&(0,t.jsx)("div",{className:"invalid-feedback",children:d.descripcion})]}),(0,t.jsxs)("div",{className:"col-md-6 mb-3",children:[(0,t.jsxs)("label",{htmlFor:"id_tipo_gasto",className:"form-label",children:["Tipo de Gasto ",(0,t.jsx)("span",{className:"text-danger",children:"*"})]}),(0,t.jsxs)("select",{className:"form-control ".concat(d.id_tipo_gasto?"is-invalid":""),id:"id_tipo_gasto",name:"id_tipo_gasto",value:l.id_tipo_gasto,onChange:handleChange,required:!0,children:[(0,t.jsx)("option",{value:"",children:"Seleccionar tipo"}),h.map(a=>(0,t.jsx)("option",{value:a.id_tipo_gasto,children:a.descripcion},a.id_tipo_gasto))]}),d.id_tipo_gasto&&(0,t.jsx)("div",{className:"invalid-feedback",children:d.id_tipo_gasto})]}),(0,t.jsxs)("div",{className:"col-md-6 mb-3",children:[(0,t.jsxs)("label",{htmlFor:"id_categoria",className:"form-label",children:["Categor\xeda ",(0,t.jsx)("span",{className:"text-danger",children:"*"})]}),(0,t.jsxs)("select",{className:"form-control ".concat(d.id_categoria?"is-invalid":""),id:"id_categoria",name:"id_categoria",value:l.id_categoria,onChange:handleChange,required:!0,children:[(0,t.jsx)("option",{value:"",children:"Seleccionar categor\xeda"}),x.map(a=>(0,t.jsx)("option",{value:a.id_categoria,children:a.categoria},a.id_categoria))]}),d.id_categoria&&(0,t.jsx)("div",{className:"invalid-feedback",children:d.id_categoria})]}),(0,t.jsxs)("div",{className:"col-md-4 mb-3",children:[(0,t.jsxs)("label",{htmlFor:"monto_total",className:"form-label",children:["Monto Total ",(0,t.jsx)("span",{className:"text-danger",children:"*"})]}),(0,t.jsx)("input",{type:"number",step:"0.01",className:"form-control ".concat(d.monto_total?"is-invalid":""),id:"monto_total",name:"monto_total",value:l.monto_total,onChange:handleChange,min:"0.01",required:!0}),d.monto_total&&(0,t.jsx)("div",{className:"invalid-feedback",children:d.monto_total})]}),(0,t.jsxs)("div",{className:"col-md-4 mb-3",children:[(0,t.jsxs)("label",{htmlFor:"mes",className:"form-label",children:["Mes ",(0,t.jsx)("span",{className:"text-danger",children:"*"})]}),(0,t.jsx)("select",{className:"form-control ".concat(d.mes?"is-invalid":""),id:"mes",name:"mes",value:l.mes,onChange:handleChange,required:!0,children:Array.from({length:12},(a,e)=>(0,t.jsx)("option",{value:e+1,children:new Date(2e3,e).toLocaleString("es-AR",{month:"long"})},e+1))}),d.mes&&(0,t.jsx)("div",{className:"invalid-feedback",children:d.mes})]}),(0,t.jsxs)("div",{className:"col-md-4 mb-3",children:[(0,t.jsxs)("label",{htmlFor:"a\xf1o",className:"form-label",children:["A\xf1o ",(0,t.jsx)("span",{className:"text-danger",children:"*"})]}),(0,t.jsx)("input",{type:"number",className:"form-control ".concat(d.año?"is-invalid":""),id:"a\xf1o",name:"a\xf1o",value:l.año,onChange:handleChange,min:"2000",max:"2100",required:!0}),d.año&&(0,t.jsx)("div",{className:"invalid-feedback",children:d.año})]}),(()=>{switch(l.id_tipo_gasto){case"1":return(0,t.jsxs)("div",{className:"col-md-6 mb-3",children:[(0,t.jsxs)("label",{htmlFor:"dia_vencimiento",className:"form-label",children:["D\xeda de Vencimiento ",(0,t.jsx)("span",{className:"text-danger",children:"*"})]}),(0,t.jsx)("input",{type:"number",className:"form-control ".concat(d.dia_vencimiento?"is-invalid":""),id:"dia_vencimiento",name:"dia_vencimiento",value:l.dia_vencimiento,onChange:handleChange,min:"1",max:"31",required:!0}),d.dia_vencimiento&&(0,t.jsx)("div",{className:"invalid-feedback",children:d.dia_vencimiento})]});case"3":return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{className:"col-md-6 mb-3",children:[(0,t.jsxs)("label",{htmlFor:"total_cuotas",className:"form-label",children:["Total de Cuotas ",(0,t.jsx)("span",{className:"text-danger",children:"*"})]}),(0,t.jsx)("input",{type:"number",className:"form-control ".concat(d.total_cuotas?"is-invalid":""),id:"total_cuotas",name:"total_cuotas",value:l.total_cuotas,onChange:handleChange,min:"1",required:!0}),d.total_cuotas&&(0,t.jsx)("div",{className:"invalid-feedback",children:d.total_cuotas})]}),(0,t.jsxs)("div",{className:"col-md-6 mb-3",children:[(0,t.jsxs)("label",{htmlFor:"fecha_primera_cuota",className:"form-label",children:["Fecha Primera Cuota ",(0,t.jsx)("span",{className:"text-danger",children:"*"})]}),(0,t.jsx)("input",{type:"date",className:"form-control ".concat(d.fecha_primera_cuota?"is-invalid":""),id:"fecha_primera_cuota",name:"fecha_primera_cuota",value:l.fecha_primera_cuota,onChange:handleChange,required:!0}),d.fecha_primera_cuota&&(0,t.jsx)("div",{className:"invalid-feedback",children:d.fecha_primera_cuota})]})]});default:return null}})()]}),(0,t.jsxs)("div",{className:"d-flex justify-content-end gap-2 mt-4",children:[(0,t.jsx)("button",{type:"button",className:"btn btn-secondary",onClick:n,disabled:c,children:"Cancelar"}),(0,t.jsx)("button",{type:"submit",className:"btn btn-primary",disabled:c,children:c?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("span",{className:"spinner-border spinner-border-sm me-2"}),"Guardando..."]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("i",{className:"fas fa-save me-2"}),e?"Actualizar":"Crear"," Gasto"]})})]})]})}var o=s(5313);function GastosPage(){let[a,e]=(0,i.useState)([]),[s,c]=(0,i.useState)(!1),[r,d]=(0,i.useState)(null),[m,h]=(0,i.useState)(!0);(0,i.useEffect)(()=>{cargarGastos()},[]);let cargarGastos=async()=>{try{let a=localStorage.getItem("usuarioActual"),s=await fetch("/api/gastos?id_usuario=".concat(a)),t=await s.json();e(t)}catch(a){console.error("Error cargando gastos:",a)}finally{h(!1)}},handleEdit=a=>{d(a),c(!0)},handleDelete=async a=>{if(confirm("\xbfEst\xe1s seguro de eliminar este gasto?"))try{let e=await fetch("/api/gastos/".concat(a),{method:"DELETE"});if(e.ok)cargarGastos(),alert("Gasto eliminado correctamente");else{let a=await e.json();alert(a.error)}}catch(a){alert("Error al eliminar gasto")}},formatCurrency=a=>new Intl.NumberFormat("es-AR",{style:"currency",currency:"ARS"}).format(a);return(0,t.jsxs)("div",{className:"d-flex",children:[(0,t.jsx)(l.Z,{}),(0,t.jsxs)("div",{className:"flex-grow-1",children:[(0,t.jsx)(n.Z,{}),(0,t.jsxs)("main",{className:"container-fluid py-4",children:[(0,t.jsxs)("div",{className:"d-flex justify-content-between align-items-center mb-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h1",{className:"h3 mb-0",children:"Gesti\xf3n de Gastos"}),(0,t.jsx)("p",{className:"text-muted",children:"Administra tus gastos personales"})]}),(0,t.jsxs)("button",{className:"btn btn-primary",onClick:()=>c(!0),children:[(0,t.jsx)("i",{className:"fas fa-plus me-2"}),"Nuevo Gasto"]})]}),(0,t.jsx)("div",{className:"card",children:(0,t.jsx)("div",{className:"card-body",children:m?(0,t.jsx)("div",{className:"text-center py-4",children:(0,t.jsx)("div",{className:"spinner-border text-primary",role:"status",children:(0,t.jsx)("span",{className:"visually-hidden",children:"Cargando..."})})}):(0,t.jsx)("div",{className:"table-responsive",children:(0,t.jsxs)("table",{className:"table table-hover",children:[(0,t.jsx)("thead",{children:(0,t.jsxs)("tr",{children:[(0,t.jsx)("th",{children:"Descripci\xf3n"}),(0,t.jsx)("th",{children:"Tipo"}),(0,t.jsx)("th",{children:"Categor\xeda"}),(0,t.jsx)("th",{children:"Monto"}),(0,t.jsx)("th",{children:"Mes/A\xf1o"}),(0,t.jsx)("th",{children:"Acciones"})]})}),(0,t.jsx)("tbody",{children:a.map(a=>(0,t.jsxs)("tr",{children:[(0,t.jsx)("td",{children:a.descripcion}),(0,t.jsx)("td",{children:(0,t.jsx)("span",{className:"badge ".concat("Fijo"===a.tipo_gasto?"bg-primary":"Temporal"===a.tipo_gasto?"bg-warning":"Anual"===a.tipo_gasto?"bg-info":"bg-secondary"),children:a.tipo_gasto})}),(0,t.jsx)("td",{children:a.categoria}),(0,t.jsx)("td",{children:formatCurrency(a.monto_total)}),(0,t.jsxs)("td",{children:[a.mes,"/",a.año]}),(0,t.jsx)("td",{children:(0,t.jsxs)("div",{className:"btn-group btn-group-sm",children:[(0,t.jsx)("button",{className:"btn btn-outline-primary",onClick:()=>handleEdit(a),children:(0,t.jsx)("i",{className:"fas fa-edit"})}),(0,t.jsx)("button",{className:"btn btn-outline-danger",onClick:()=>handleDelete(a.id_gasto),children:(0,t.jsx)("i",{className:"fas fa-trash"})})]})})]},a.id_gasto))})]})})})}),s&&(0,t.jsx)("div",{className:"modal fade show d-block",tabIndex:-1,children:(0,t.jsx)("div",{className:"modal-dialog modal-lg",children:(0,t.jsxs)("div",{className:"modal-content",children:[(0,t.jsxs)("div",{className:"modal-header",children:[(0,t.jsx)("h5",{className:"modal-title",children:r?"Editar Gasto":"Nuevo Gasto"}),(0,t.jsx)("button",{type:"button",className:"btn-close",onClick:()=>c(!1)})]}),(0,t.jsx)("div",{className:"modal-body",children:(0,t.jsx)(GastoForm,{gasto:r,onSuccess:()=>{c(!1),d(null),cargarGastos()},onCancel:()=>c(!1)})})]})})})]}),(0,t.jsx)(o.Z,{})]})]})}}},function(a){a.O(0,[412,517,971,472,744],function(){return a(a.s=6160)}),_N_E=a.O()}]);