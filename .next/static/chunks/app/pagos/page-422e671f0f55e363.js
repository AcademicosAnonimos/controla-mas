(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[699],{7813:function(e,a,s){Promise.resolve().then(s.bind(s,1038))},1038:function(e,a,s){"use strict";s.r(a),s.d(a,{default:function(){return PagosPage}});var o=s(7437),i=s(2265),t=s(5220),l=s(6264);function PagoForm(e){let{pago:a,onSuccess:s,onCancel:t}=e,[l,r]=(0,i.useState)({importe_a_pagar:0,fecha_pago:new Date().toISOString().split("T")[0],id_gasto:"",medios_pago:[{id_medio_pago:"",importe_pagado:0}],mes_impacto:new Date().getMonth()+1,año_impacto:new Date().getFullYear()}),[n,d]=(0,i.useState)(!1),[c,m]=(0,i.useState)({}),[g,p]=(0,i.useState)([]),[h,x]=(0,i.useState)([]),[_,u]=(0,i.useState)(0);(0,i.useEffect)(()=>{if(cargarDatosIniciales(),a)r({...a,medios_pago:a.medios_pago||[{id_medio_pago:"",importe_pagado:0}]});else{let e=localStorage.getItem("usuarioActual");e&&cargarGastos(e)}},[a]);let cargarDatosIniciales=async()=>{try{let e=await fetch("/api/medio-pago"),a=await e.json();p(a)}catch(e){console.error("Error cargando medios de pago:",e)}},cargarGastos=async e=>{try{let a=await fetch("/api/gastos?id_usuario=".concat(e)),s=await a.json();x(s)}catch(e){console.error("Error cargando gastos:",e)}},validateForm=()=>{let e={};l.importe_a_pagar<=0&&(e.importe_a_pagar="Importe debe ser mayor a 0"),l.id_gasto||(e.id_gasto="Gasto es requerido"),l.fecha_pago||(e.fecha_pago="Fecha de pago es requerida");let a=l.medios_pago.reduce((e,a)=>e+(a.importe_pagado||0),0);return a!==l.importe_a_pagar&&(e.medios_pago="La suma de medios de pago (".concat(a,") no coincide con el importe total (").concat(l.importe_a_pagar,")")),u(a),m(e),0===Object.keys(e).length},handleSubmit=async e=>{if(e.preventDefault(),validateForm()){d(!0);try{let e=await fetch("/api/pagos",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(l)});if(e.ok)s(),alert("Pago registrado correctamente");else{let a=await e.json();alert(a.error)}}catch(e){alert("Error al registrar pago")}finally{d(!1)}}},handleChange=e=>{let{name:a,value:s}=e.target;r(e=>({...e,[a]:a.includes("importe")||a.includes("mes")||a.includes("a\xf1o")?""===s?"":Number(s):s}))},handleMedioChange=(e,a,s)=>{let o=[...l.medios_pago];o[e]={...o[e],[a]:"importe_pagado"===a?Number(s):s},r(e=>({...e,medios_pago:o}))},removeMedioPago=e=>{if(l.medios_pago.length>1){let a=l.medios_pago.filter((a,s)=>s!==e);r(e=>({...e,medios_pago:a}))}},j=l.medios_pago.some(e=>"3"===e.id_medio_pago);return(0,o.jsxs)("form",{onSubmit:handleSubmit,children:[(0,o.jsxs)("div",{className:"row",children:[(0,o.jsxs)("div",{className:"col-md-6 mb-3",children:[(0,o.jsxs)("label",{htmlFor:"id_gasto",className:"form-label",children:["Gasto ",(0,o.jsx)("span",{className:"text-danger",children:"*"})]}),(0,o.jsxs)("select",{className:"form-control ".concat(c.id_gasto?"is-invalid":""),id:"id_gasto",name:"id_gasto",value:l.id_gasto,onChange:handleChange,required:!0,children:[(0,o.jsx)("option",{value:"",children:"Seleccionar gasto"}),h.map(e=>(0,o.jsxs)("option",{value:e.id_gasto,children:[e.descripcion," - ",e.monto_total," (",e.tipo_gasto,")"]},e.id_gasto))]}),c.id_gasto&&(0,o.jsx)("div",{className:"invalid-feedback",children:c.id_gasto})]}),(0,o.jsxs)("div",{className:"col-md-6 mb-3",children:[(0,o.jsxs)("label",{htmlFor:"fecha_pago",className:"form-label",children:["Fecha de Pago ",(0,o.jsx)("span",{className:"text-danger",children:"*"})]}),(0,o.jsx)("input",{type:"date",className:"form-control ".concat(c.fecha_pago?"is-invalid":""),id:"fecha_pago",name:"fecha_pago",value:l.fecha_pago,onChange:handleChange,required:!0}),c.fecha_pago&&(0,o.jsx)("div",{className:"invalid-feedback",children:c.fecha_pago})]}),(0,o.jsxs)("div",{className:"col-12 mb-3",children:[(0,o.jsxs)("label",{htmlFor:"importe_a_pagar",className:"form-label",children:["Importe a Pagar ",(0,o.jsx)("span",{className:"text-danger",children:"*"})]}),(0,o.jsx)("input",{type:"number",step:"0.01",className:"form-control ".concat(c.importe_a_pagar?"is-invalid":""),id:"importe_a_pagar",name:"importe_a_pagar",value:l.importe_a_pagar,onChange:handleChange,min:"0.01",required:!0}),c.importe_a_pagar&&(0,o.jsx)("div",{className:"invalid-feedback",children:c.importe_a_pagar})]}),(0,o.jsxs)("div",{className:"col-12 mb-3",children:[(0,o.jsxs)("div",{className:"d-flex justify-content-between align-items-center mb-3",children:[(0,o.jsx)("label",{className:"form-label",children:"Medios de Pago"}),(0,o.jsxs)("button",{type:"button",className:"btn btn-sm btn-outline-primary",onClick:()=>{r(e=>({...e,medios_pago:[...e.medios_pago,{id_medio_pago:"",importe_pagado:0}]}))},children:[(0,o.jsx)("i",{className:"fas fa-plus me-1"}),"Agregar Medio"]})]}),l.medios_pago.map((e,a)=>(0,o.jsxs)("div",{className:"row mb-2 align-items-end",children:[(0,o.jsxs)("div",{className:"col-md-6",children:[(0,o.jsx)("label",{className:"form-label",children:"Medio"}),(0,o.jsxs)("select",{className:"form-control",value:e.id_medio_pago,onChange:e=>handleMedioChange(a,"id_medio_pago",e.target.value),required:!0,children:[(0,o.jsx)("option",{value:"",children:"Seleccionar medio"}),g.map(e=>(0,o.jsx)("option",{value:e.id_medio_pago,children:e.medio_pago},e.id_medio_pago))]})]}),(0,o.jsxs)("div",{className:"col-md-4",children:[(0,o.jsx)("label",{className:"form-label",children:"Importe"}),(0,o.jsx)("input",{type:"number",step:"0.01",className:"form-control",value:e.importe_pagado,onChange:e=>handleMedioChange(a,"importe_pagado",e.target.value),min:"0.01",required:!0})]}),(0,o.jsx)("div",{className:"col-md-2",children:l.medios_pago.length>1&&(0,o.jsx)("button",{type:"button",className:"btn btn-outline-danger w-100",onClick:()=>removeMedioPago(a),children:(0,o.jsx)("i",{className:"fas fa-times"})})})]},a)),c.medios_pago&&(0,o.jsx)("div",{className:"text-danger small mt-2",children:c.medios_pago}),(0,o.jsx)("div",{className:"mt-2",children:(0,o.jsxs)("small",{className:"text-muted",children:["Total medios: ",_.toFixed(2)," | Importe total: ",l.importe_a_pagar.toFixed(2)," | Diferencia: ",(l.importe_a_pagar-_).toFixed(2)]})})]}),j&&(0,o.jsxs)("div",{className:"col-12 mb-3 p-3 border rounded bg-light",children:[(0,o.jsxs)("h6",{className:"mb-3",children:[(0,o.jsx)("i",{className:"fas fa-calendar-alt me-2"}),"Impacto para Tarjeta de Cr\xe9dito"]}),(0,o.jsxs)("div",{className:"row",children:[(0,o.jsxs)("div",{className:"col-md-6",children:[(0,o.jsx)("label",{htmlFor:"mes_impacto",className:"form-label",children:"Mes de Impacto"}),(0,o.jsx)("select",{className:"form-control",id:"mes_impacto",name:"mes_impacto",value:l.mes_impacto,onChange:handleChange,children:Array.from({length:12},(e,a)=>(0,o.jsx)("option",{value:a+1,children:new Date(2e3,a).toLocaleString("es-AR",{month:"long"})},a+1))})]}),(0,o.jsxs)("div",{className:"col-md-6",children:[(0,o.jsx)("label",{htmlFor:"a\xf1o_impacto",className:"form-label",children:"A\xf1o de Impacto"}),(0,o.jsx)("input",{type:"number",className:"form-control",id:"a\xf1o_impacto",name:"a\xf1o_impacto",value:l.año_impacto,onChange:handleChange,min:"2020",max:"2030"})]})]})]})]}),(0,o.jsxs)("div",{className:"d-flex justify-content-end gap-2 mt-4",children:[(0,o.jsx)("button",{type:"button",className:"btn btn-secondary",onClick:t,disabled:n,children:"Cancelar"}),(0,o.jsx)("button",{type:"submit",className:"btn btn-primary",disabled:n,children:n?(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("span",{className:"spinner-border spinner-border-sm me-2"}),"Guardando..."]}):(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("i",{className:"fas fa-credit-card me-2"}),"Registrar Pago"]})})]})]})}var r=s(5313);function PagosPage(){let[e,a]=(0,i.useState)([]),[s,n]=(0,i.useState)(!1),[d,c]=(0,i.useState)(!0);(0,i.useEffect)(()=>{cargarPagos()},[]);let cargarPagos=async()=>{try{let e=localStorage.getItem("usuarioActual"),s=await fetch("/api/pagos?id_usuario=".concat(e)),o=await s.json();a(o)}catch(e){console.error("Error cargando pagos:",e)}finally{c(!1)}},formatCurrency=e=>new Intl.NumberFormat("es-AR",{style:"currency",currency:"ARS"}).format(e),formatDate=e=>new Date(e).toLocaleDateString("es-AR");return(0,o.jsxs)("div",{className:"d-flex",children:[(0,o.jsx)(l.Z,{}),(0,o.jsxs)("div",{className:"flex-grow-1",children:[(0,o.jsx)(t.Z,{}),(0,o.jsxs)("main",{className:"container-fluid py-4",children:[(0,o.jsxs)("div",{className:"d-flex justify-content-between align-items-center mb-4",children:[(0,o.jsxs)("div",{children:[(0,o.jsx)("h1",{className:"h3 mb-0",children:"Gesti\xf3n de Pagos"}),(0,o.jsx)("p",{className:"text-muted",children:"Registra y visualiza tus pagos"})]}),(0,o.jsxs)("button",{className:"btn btn-primary",onClick:()=>n(!0),children:[(0,o.jsx)("i",{className:"fas fa-plus me-2"}),"Nuevo Pago"]})]}),(0,o.jsx)("div",{className:"card",children:(0,o.jsx)("div",{className:"card-body",children:d?(0,o.jsx)("div",{className:"text-center py-4",children:(0,o.jsx)("div",{className:"spinner-border text-primary",role:"status",children:(0,o.jsx)("span",{className:"visually-hidden",children:"Cargando..."})})}):(0,o.jsx)("div",{className:"table-responsive",children:(0,o.jsxs)("table",{className:"table table-hover",children:[(0,o.jsx)("thead",{children:(0,o.jsxs)("tr",{children:[(0,o.jsx)("th",{children:"Descripci\xf3n"}),(0,o.jsx)("th",{children:"Importe"}),(0,o.jsx)("th",{children:"Fecha Pago"}),(0,o.jsx)("th",{children:"Medios de Pago"}),(0,o.jsx)("th",{children:"Acciones"})]})}),(0,o.jsx)("tbody",{children:e.map(e=>(0,o.jsxs)("tr",{children:[(0,o.jsx)("td",{children:e.descripcion_gasto}),(0,o.jsx)("td",{children:formatCurrency(e.importe_a_pagar)}),(0,o.jsx)("td",{children:formatDate(e.fecha_pago)}),(0,o.jsx)("td",{children:e.medios_pago&&e.medios_pago.length>0?(0,o.jsx)("div",{children:e.medios_pago.map((e,a)=>(0,o.jsxs)("span",{className:"badge bg-light text-dark me-1",children:[e.medio_pago,": ",formatCurrency(e.importe_pagado)]},a))}):(0,o.jsx)("span",{className:"text-muted",children:"Sin medios registrados"})}),(0,o.jsx)("td",{children:(0,o.jsx)("button",{className:"btn btn-outline-primary btn-sm",children:(0,o.jsx)("i",{className:"fas fa-eye"})})})]},e.id_pago))})]})})})}),s&&(0,o.jsx)("div",{className:"modal fade show d-block",tabIndex:-1,children:(0,o.jsx)("div",{className:"modal-dialog modal-lg",children:(0,o.jsxs)("div",{className:"modal-content",children:[(0,o.jsxs)("div",{className:"modal-header",children:[(0,o.jsx)("h5",{className:"modal-title",children:"Registrar Nuevo Pago"}),(0,o.jsx)("button",{type:"button",className:"btn-close",onClick:()=>n(!1)})]}),(0,o.jsx)("div",{className:"modal-body",children:(0,o.jsx)(PagoForm,{onSuccess:()=>{n(!1),cargarPagos()},onCancel:()=>n(!1)})})]})})})]}),(0,o.jsx)(r.Z,{})]})]})}}},function(e){e.O(0,[412,517,971,472,744],function(){return e(e.s=7813)}),_N_E=e.O()}]);