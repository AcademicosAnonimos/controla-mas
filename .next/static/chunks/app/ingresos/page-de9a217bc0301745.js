(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[622],{2509:function(e,s,a){Promise.resolve().then(a.bind(a,4030))},4030:function(e,s,a){"use strict";a.r(s),a.d(s,{default:function(){return IngresosPage}});var n=a(7437),r=a(2265),i=a(5220),t=a(6264);function IngresoForm(e){let{ingreso:s,onSuccess:a,onCancel:i}=e,[t,l]=(0,r.useState)({descripcion:"",fecha_ingreso:new Date().toISOString().split("T")[0],monto:0,id_usuario:0}),[c,o]=(0,r.useState)(!1),[d,m]=(0,r.useState)({});(0,r.useEffect)(()=>{if(s)l(s);else{let e=localStorage.getItem("usuarioActual");e&&l(s=>({...s,id_usuario:parseInt(e)}))}},[s]);let validateForm=()=>{let e={};return t.descripcion.trim()||(e.descripcion="La descripci\xf3n es requerida"),t.fecha_ingreso||(e.fecha_ingreso="La fecha es requerida"),t.monto<=0&&(e.monto="El monto debe ser mayor a 0"),t.id_usuario||(e.id_usuario="Usuario es requerido"),m(e),0===Object.keys(e).length},handleSubmit=async e=>{if(e.preventDefault(),validateForm()){o(!0);try{let e=s?"/api/ingresos/".concat(s.id_ingreso):"/api/ingresos",n=s?"PUT":"POST",r=await fetch(e,{method:n,headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(r.ok)a(),alert(s?"Ingreso actualizado correctamente":"Ingreso creado correctamente");else{let e=await r.json();alert(e.error)}}catch(e){alert("Error al guardar ingreso")}finally{o(!1)}}},handleChange=e=>{let{name:s,value:a}=e.target;l(e=>({...e,[s]:"monto"===s?parseFloat(a)||0:"id_usuario"===s?parseInt(a)||0:a}))};return(0,n.jsxs)("form",{onSubmit:handleSubmit,children:[(0,n.jsxs)("div",{className:"row",children:[(0,n.jsxs)("div",{className:"col-12 mb-3",children:[(0,n.jsxs)("label",{htmlFor:"descripcion",className:"form-label",children:["Descripci\xf3n ",(0,n.jsx)("span",{className:"text-danger",children:"*"})]}),(0,n.jsx)("textarea",{className:"form-control ".concat(d.descripcion?"is-invalid":""),id:"descripcion",name:"descripcion",value:t.descripcion,onChange:handleChange,rows:3,required:!0}),d.descripcion&&(0,n.jsx)("div",{className:"invalid-feedback",children:d.descripcion})]}),(0,n.jsxs)("div",{className:"col-md-6 mb-3",children:[(0,n.jsxs)("label",{htmlFor:"fecha_ingreso",className:"form-label",children:["Fecha ",(0,n.jsx)("span",{className:"text-danger",children:"*"})]}),(0,n.jsx)("input",{type:"date",className:"form-control ".concat(d.fecha_ingreso?"is-invalid":""),id:"fecha_ingreso",name:"fecha_ingreso",value:t.fecha_ingreso,onChange:handleChange,required:!0}),d.fecha_ingreso&&(0,n.jsx)("div",{className:"invalid-feedback",children:d.fecha_ingreso})]}),(0,n.jsxs)("div",{className:"col-md-6 mb-3",children:[(0,n.jsxs)("label",{htmlFor:"monto",className:"form-label",children:["Monto ",(0,n.jsx)("span",{className:"text-danger",children:"*"})]}),(0,n.jsx)("input",{type:"number",step:"0.01",className:"form-control ".concat(d.monto?"is-invalid":""),id:"monto",name:"monto",value:t.monto,onChange:handleChange,min:"0.01",required:!0}),d.monto&&(0,n.jsx)("div",{className:"invalid-feedback",children:d.monto})]})]}),(0,n.jsxs)("div",{className:"d-flex justify-content-end gap-2 mt-4",children:[(0,n.jsx)("button",{type:"button",className:"btn btn-secondary",onClick:i,disabled:c,children:"Cancelar"}),(0,n.jsx)("button",{type:"submit",className:"btn btn-primary",disabled:c,children:c?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("span",{className:"spinner-border spinner-border-sm me-2",role:"status"}),"Guardando..."]}):(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("i",{className:"fas fa-save me-2"}),s?"Actualizar":"Crear"," Ingreso"]})})]})]})}var l=a(5313);function IngresosPage(){let[e,s]=(0,r.useState)([]),[a,c]=(0,r.useState)(!1),[o,d]=(0,r.useState)(null),[m,h]=(0,r.useState)(!0);(0,r.useEffect)(()=>{cargarIngresos()},[]);let cargarIngresos=async()=>{try{let e=localStorage.getItem("usuarioActual"),a=await fetch("/api/ingresos?id_usuario=".concat(e)),n=await a.json();s(n)}catch(e){console.error("Error cargando ingresos:",e)}finally{h(!1)}},handleEdit=e=>{d(e),c(!0)},handleDelete=async e=>{if(confirm("\xbfEst\xe1s seguro de eliminar este ingreso?"))try{let s=await fetch("/api/ingresos/".concat(e),{method:"DELETE"});if(s.ok)cargarIngresos(),alert("Ingreso eliminado correctamente");else{let e=await s.json();alert(e.error)}}catch(e){alert("Error al eliminar ingreso")}},formatCurrency=e=>new Intl.NumberFormat("es-AR",{style:"currency",currency:"ARS"}).format(e),formatDate=e=>new Date(e).toLocaleDateString("es-AR");return(0,n.jsxs)("div",{className:"d-flex",children:[(0,n.jsx)(t.Z,{}),(0,n.jsxs)("div",{className:"flex-grow-1",children:[(0,n.jsx)(i.Z,{}),(0,n.jsxs)("main",{className:"container-fluid py-4",children:[(0,n.jsxs)("div",{className:"d-flex justify-content-between align-items-center mb-4",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("h1",{className:"h3 mb-0",children:"Gesti\xf3n de Ingresos"}),(0,n.jsx)("p",{className:"text-muted",children:"Administra tus ingresos personales"})]}),(0,n.jsxs)("button",{className:"btn btn-primary",onClick:()=>c(!0),children:[(0,n.jsx)("i",{className:"fas fa-plus me-2"}),"Nuevo Ingreso"]})]}),(0,n.jsx)("div",{className:"card",children:(0,n.jsx)("div",{className:"card-body",children:m?(0,n.jsx)("div",{className:"text-center py-4",children:(0,n.jsx)("div",{className:"spinner-border text-primary",role:"status",children:(0,n.jsx)("span",{className:"visually-hidden",children:"Cargando..."})})}):(0,n.jsxs)("div",{className:"table-responsive",children:[(0,n.jsxs)("table",{className:"table table-hover",children:[(0,n.jsx)("thead",{children:(0,n.jsxs)("tr",{children:[(0,n.jsx)("th",{children:"Descripci\xf3n"}),(0,n.jsx)("th",{children:"Fecha"}),(0,n.jsx)("th",{children:"Monto"}),(0,n.jsx)("th",{children:"Usuario"}),(0,n.jsx)("th",{children:"Acciones"})]})}),(0,n.jsx)("tbody",{children:e.map(e=>(0,n.jsxs)("tr",{children:[(0,n.jsx)("td",{children:e.descripcion}),(0,n.jsx)("td",{children:formatDate(e.fecha_ingreso)}),(0,n.jsxs)("td",{className:"text-success fw-bold",children:["+",formatCurrency(e.monto)]}),(0,n.jsx)("td",{children:e.usuario_nombre}),(0,n.jsx)("td",{children:(0,n.jsxs)("div",{className:"btn-group btn-group-sm",children:[(0,n.jsx)("button",{className:"btn btn-outline-primary",onClick:()=>handleEdit(e),children:(0,n.jsx)("i",{className:"fas fa-edit"})}),(0,n.jsx)("button",{className:"btn btn-outline-danger",onClick:()=>handleDelete(e.id_ingreso),children:(0,n.jsx)("i",{className:"fas fa-trash"})})]})})]},e.id_ingreso))})]}),0===e.length&&(0,n.jsxs)("div",{className:"text-center py-5 text-muted",children:[(0,n.jsx)("i",{className:"fas fa-money-bill-wave fa-3x mb-3"}),(0,n.jsx)("p",{children:"No hay ingresos registrados"}),(0,n.jsxs)("button",{className:"btn btn-primary",onClick:()=>c(!0),children:[(0,n.jsx)("i",{className:"fas fa-plus me-2"}),"Registrar Primer Ingreso"]})]})]})})}),a&&(0,n.jsx)("div",{className:"modal fade show d-block",tabIndex:-1,children:(0,n.jsx)("div",{className:"modal-dialog modal-lg",children:(0,n.jsxs)("div",{className:"modal-content",children:[(0,n.jsxs)("div",{className:"modal-header",children:[(0,n.jsx)("h5",{className:"modal-title",children:o?"Editar Ingreso":"Nuevo Ingreso"}),(0,n.jsx)("button",{type:"button",className:"btn-close",onClick:()=>c(!1)})]}),(0,n.jsx)("div",{className:"modal-body",children:(0,n.jsx)(IngresoForm,{ingreso:o,onSuccess:()=>{c(!1),d(null),cargarIngresos()},onCancel:()=>c(!1)})})]})})})]}),(0,n.jsx)(l.Z,{})]})]})}}},function(e){e.O(0,[412,517,971,472,744],function(){return e(e.s=2509)}),_N_E=e.O()}]);