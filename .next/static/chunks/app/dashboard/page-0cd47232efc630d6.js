(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[702],{3683:function(a,e,s){Promise.resolve().then(s.bind(s,8645))},8645:function(a,e,s){"use strict";s.r(e),s.d(e,{default:function(){return Dashboard}});var r=s(7437),t=s(2265),i=s(5220),c=s(6264);function DashboardCards(a){var e,s;let{data:i}=a,[c,l]=(0,t.useState)(0);(0,t.useEffect)(()=>{if(i){let a=Number(i.saldo_actual)||0;l(a)}},[i]);let formatCurrency=a=>{let e=Number(a)||0;return new Intl.NumberFormat("es-AR",{style:"currency",currency:"ARS",minimumFractionDigits:2,maximumFractionDigits:2}).format(e)},d=[{title:"SALDO ACTUAL",value:formatCurrency(c),icon:"fas fa-wallet",color:"primary",description:"Disponible para gastar",hasData:null!==i},{title:"INGRESOS DEL MES",value:formatCurrency((null==i?void 0:i.ingresos_mes)||0),icon:"fas fa-arrow-down",color:"success",description:"Total de ingresos",hasData:null!==i&&Number(null==i?void 0:i.ingresos_mes)>0},{title:"GASTOS DEL MES",value:formatCurrency((null==i?void 0:i.gastos_mes)||0),icon:"fas fa-arrow-up",color:"danger",description:"Total de gastos",hasData:null!==i&&Number(null==i?void 0:i.gastos_mes)>0},{title:"PR\xd3XIMAS CUOTAS",value:(null==i?void 0:null===(e=i.proximas_cuotas)||void 0===e?void 0:e.length)>0?(a=>{let e=Number(a)||0;return e.toLocaleString("es-AR")})(i.proximas_cuotas.length):"0",icon:"fas fa-calendar",color:"warning",description:"Pendientes de pago",hasData:null!==i&&(null==i?void 0:null===(s=i.proximas_cuotas)||void 0===s?void 0:s.length)>0}];return i?(0,r.jsx)("div",{className:"row",children:d.map((a,e)=>(0,r.jsx)("div",{className:"col-xl-3 col-md-6 mb-4",children:(0,r.jsx)("div",{className:"card border-left-".concat(a.color," shadow h-100 py-2 card-hover"),children:(0,r.jsx)("div",{className:"card-body",children:(0,r.jsxs)("div",{className:"row no-gutters align-items-center",children:[(0,r.jsxs)("div",{className:"col mr-2",children:[(0,r.jsx)("div",{className:"text-xs font-weight-bold text-".concat(a.color," text-uppercase mb-1"),children:a.title}),(0,r.jsx)("div",{className:"h5 mb-0 font-weight-bold ".concat(a.hasData?"text-gray-800":"text-muted"),children:a.value}),(0,r.jsxs)("div",{className:"text-xs text-muted mt-1",children:[a.description,!a.hasData&&"SALDO ACTUAL"!==a.title&&(0,r.jsxs)("span",{className:"text-warning ms-1",children:[(0,r.jsx)("i",{className:"fas fa-exclamation-circle me-1"}),"Sin datos"]})]})]}),(0,r.jsx)("div",{className:"col-auto",children:(0,r.jsx)("i",{className:"".concat(a.icon," fa-2x text-").concat(a.color," ").concat(a.hasData?"":"opacity-50")})})]})})})},e))}):(0,r.jsx)("div",{className:"row",children:d.map((a,e)=>(0,r.jsx)("div",{className:"col-xl-3 col-md-6 mb-4",children:(0,r.jsx)("div",{className:"card border-left-secondary shadow h-100 py-2",children:(0,r.jsx)("div",{className:"card-body",children:(0,r.jsxs)("div",{className:"row no-gutters align-items-center",children:[(0,r.jsxs)("div",{className:"col mr-2",children:[(0,r.jsx)("div",{className:"text-xs font-weight-bold text-secondary text-uppercase mb-1",children:"Cargando..."}),(0,r.jsx)("div",{className:"h5 mb-0 font-weight-bold text-gray-800",children:(0,r.jsx)("div",{className:"spinner-border spinner-border-sm text-primary",role:"status",children:(0,r.jsx)("span",{className:"visually-hidden",children:"Cargando..."})})}),(0,r.jsx)("div",{className:"text-xs text-muted mt-1",children:"\xa0"})]}),(0,r.jsx)("div",{className:"col-auto",children:(0,r.jsx)("i",{className:"fas fa-spinner fa-2x text-secondary"})})]})})})},e))})}var l=s(105),d=s(6704);function CategoryChart(a){let{data:e}=a,s={labels:e.map(a=>a.categoria),datasets:[{data:e.map(a=>a.total),backgroundColor:["#FF6384","#36A2EB","#FFCE56","#4BC0C0","#9966FF","#FF9F40","#FF6384","#C9CBCF"],borderWidth:2,borderColor:"#fff"}]};return(0,r.jsx)("div",{style:{height:"300px"},children:e.length>0?(0,r.jsx)(l.$I,{data:s,options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{position:"bottom"}}}}):(0,r.jsxs)("div",{className:"text-center text-muted py-5",children:[(0,r.jsx)("i",{className:"fas fa-chart-pie fa-3x mb-3"}),(0,r.jsx)("p",{children:"No hay datos para mostrar"})]})})}function PredictionChart(a){let{data:e}=a,s={labels:e.map(a=>a.categoria),datasets:[{label:"Monto Predicho",data:e.map(a=>a.monto_predicho),backgroundColor:"rgba(52, 152, 219, 0.6)",borderColor:"rgba(52, 152, 219, 1)",borderWidth:1}]};return(0,r.jsx)("div",{style:{height:"300px"},children:e.length>0?(0,r.jsx)(l.$Q,{data:s,options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1},title:{display:!0,text:"Predicci\xf3n para el pr\xf3ximo mes"}},scales:{y:{beginAtZero:!0,ticks:{callback:function(a){return new Intl.NumberFormat("es-AR",{style:"currency",currency:"ARS"}).format(a)}}}}}}):(0,r.jsxs)("div",{className:"text-center text-muted py-5",children:[(0,r.jsx)("i",{className:"fas fa-chart-line fa-3x mb-3"}),(0,r.jsx)("p",{children:"No hay datos de predicci\xf3n disponibles"})]})})}d.kL.register(d.qi,d.u,d.De),d.kL.register(d.uw,d.f$,d.ZL,d.Dx,d.u,d.De);var o=s(5313);function Dashboard(){var a;let[e,s]=(0,t.useState)(null),[l,d]=(0,t.useState)(!0);(0,t.useEffect)(()=>{cargarDashboard()},[]);let cargarDashboard=async()=>{try{d(!0);let a=localStorage.getItem("usuarioActual");if(!a)throw Error("No se encontr\xf3 ID de usuario");let e=await fetch("/api/dashboard?id_usuario=".concat(a));if(!e.ok){let a=await e.json();throw Error(a.error||"Error al cargar datos")}let r=await e.json(),t={...r,saldo_actual:Number(r.saldo_actual)||0,ingresos_mes:Number(r.ingresos_mes)||0,gastos_mes:Number(r.gastos_mes)||0};s(t)}catch(a){console.error("Error cargando dashboard:",a),s({saldo_actual:0,ingresos_mes:0,gastos_mes:0,proximas_cuotas:[],gastos_por_categoria:[],prediccion_proximo_mes:[]})}finally{d(!1)}};return l?(0,r.jsx)("div",{className:"d-flex justify-content-center align-items-center min-vh-100",children:(0,r.jsx)("div",{className:"spinner-border text-primary",role:"status",children:(0,r.jsx)("span",{className:"visually-hidden",children:"Cargando..."})})}):(0,r.jsxs)("div",{className:"d-flex",children:[(0,r.jsx)(c.Z,{}),(0,r.jsxs)("div",{className:"flex-grow-1",children:[(0,r.jsx)(i.Z,{}),(0,r.jsxs)("main",{className:"container-fluid py-4",children:[(0,r.jsx)("div",{className:"row mb-4",children:(0,r.jsxs)("div",{className:"col-12",children:[(0,r.jsx)("h1",{className:"h3 mb-0",children:"Dashboard"}),(0,r.jsx)("p",{className:"text-muted",children:"Resumen de tu situaci\xf3n financiera"})]})}),(0,r.jsx)(DashboardCards,{data:e}),(0,r.jsxs)("div",{className:"row mt-4",children:[(0,r.jsx)("div",{className:"col-lg-6 mb-4",children:(0,r.jsxs)("div",{className:"card h-100",children:[(0,r.jsx)("div",{className:"card-header",children:(0,r.jsxs)("h5",{className:"card-title mb-0",children:[(0,r.jsx)("i",{className:"fas fa-chart-pie me-2"}),"Gastos por Categor\xeda (\xdaltimos 6 meses)"]})}),(0,r.jsx)("div",{className:"card-body",children:(0,r.jsx)(CategoryChart,{data:(null==e?void 0:e.gastos_por_categoria)||[]})})]})}),(0,r.jsx)("div",{className:"col-lg-6 mb-4",children:(0,r.jsxs)("div",{className:"card h-100",children:[(0,r.jsx)("div",{className:"card-header",children:(0,r.jsxs)("h5",{className:"card-title mb-0",children:[(0,r.jsx)("i",{className:"fas fa-chart-line me-2"}),"Predicci\xf3n Pr\xf3ximo Mes"]})}),(0,r.jsx)("div",{className:"card-body",children:(0,r.jsx)(PredictionChart,{data:(null==e?void 0:e.prediccion_proximo_mes)||[]})})]})})]}),(0,r.jsx)("div",{className:"row mt-4",children:(0,r.jsx)("div",{className:"col-12",children:(0,r.jsxs)("div",{className:"card",children:[(0,r.jsx)("div",{className:"card-header",children:(0,r.jsxs)("h5",{className:"card-title mb-0",children:[(0,r.jsx)("i",{className:"fas fa-calendar-alt me-2"}),"Pr\xf3ximas Cuotas a Vencer"]})}),(0,r.jsx)("div",{className:"card-body",children:(null==e?void 0:null===(a=e.proximas_cuotas)||void 0===a?void 0:a.length)>0?(0,r.jsx)("div",{className:"table-responsive",children:(0,r.jsxs)("table",{className:"table table-hover",children:[(0,r.jsx)("thead",{children:(0,r.jsxs)("tr",{children:[(0,r.jsx)("th",{children:"Descripci\xf3n"}),(0,r.jsx)("th",{children:"Cuota"}),(0,r.jsx)("th",{children:"Vencimiento"}),(0,r.jsx)("th",{children:"Estado"})]})}),(0,r.jsx)("tbody",{children:e.proximas_cuotas.map(a=>(0,r.jsxs)("tr",{children:[(0,r.jsx)("td",{children:a.descripcion_gasto}),(0,r.jsxs)("td",{children:[a.nro_cuota,"/",a.total_cuotas]}),(0,r.jsx)("td",{children:new Date(a.fecha_vencimiento_cuota).toLocaleDateString()}),(0,r.jsx)("td",{children:(0,r.jsx)("span",{className:"badge ".concat("Pagada"===a.estado?"bg-success":"bg-warning"),children:a.estado})})]},a.id_cuota))})]})}):(0,r.jsx)("p",{className:"text-muted text-center py-3",children:"No hay cuotas pendientes pr\xf3ximas a vencer."})})]})})})]}),(0,r.jsx)(o.Z,{})]})]})}}},function(a){a.O(0,[674,412,149,517,971,472,744],function(){return a(a.s=3683)}),_N_E=a.O()}]);