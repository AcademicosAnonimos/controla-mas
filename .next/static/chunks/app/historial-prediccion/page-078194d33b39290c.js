(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[727],{3186:function(e,s,a){Promise.resolve().then(a.bind(a,5322))},5322:function(e,s,a){"use strict";a.r(s),a.d(s,{default:function(){return HistorialPrediccionPage}});var r=a(7437),i=a(2265),c=a(5220),l=a(6264),t=a(5313);function HistorialPrediccionPage(){let[e,s]=(0,i.useState)([]),[a,n]=(0,i.useState)(!0),[o,d]=(0,i.useState)(""),[m,x]=(0,i.useState)("");(0,i.useEffect)(()=>{cargarHistorial()},[o,m]);let cargarHistorial=async()=>{try{let e=localStorage.getItem("usuarioActual"),a="/api/historial-prediccion?id_usuario=".concat(e);o&&(a+="&mes=".concat(o)),m&&(a+="&a\xf1o=".concat(m));let r=await fetch(a),i=await r.json();s(i)}catch(e){console.error("Error cargando historial de predicci\xf3n:",e)}finally{n(!1)}},parseMontoPredicho=e=>{if(!e)return 0;let s=parseFloat(e);return isNaN(s)?0:s},formatCurrency=e=>new Intl.NumberFormat("es-AR",{style:"currency",currency:"ARS"}).format(e),h=Array.from(new Set(e.map(e=>e.año))).sort((e,s)=>s-e),j=Array.from(new Set(e.map(e=>e.mes))).sort((e,s)=>e-s),u=e.reduce((e,s)=>{let a="".concat(s.año,"-").concat(s.mes);e[a]||(e[a]={año:s.año,mes:s.mes,nombre_mes:s.nombre_mes,total_predicho:0,categorias:[]});let r=parseMontoPredicho(s.monto_predicho);return e[a].total_predicho+=r,e[a].categorias.push(s),e},{}),f=Object.values(u).sort((e,s)=>e.año!==s.año?s.año-e.año:s.mes-e.mes);return(0,r.jsxs)("div",{className:"d-flex",children:[(0,r.jsx)(l.Z,{}),(0,r.jsxs)("div",{className:"flex-grow-1",children:[(0,r.jsx)(c.Z,{}),(0,r.jsxs)("main",{className:"container-fluid py-4",children:[(0,r.jsx)("div",{className:"d-flex justify-content-between align-items-center mb-4",children:(0,r.jsxs)("div",{children:[(0,r.jsx)("h1",{className:"h3 mb-0",children:"Historial de Predicciones"}),(0,r.jsx)("p",{className:"text-muted",children:"An\xe1lisis de tendencias de gastos por categor\xeda"})]})}),(0,r.jsx)("div",{className:"card bg-light border-0 mb-4",children:(0,r.jsxs)("div",{className:"card-body",children:[(0,r.jsxs)("h5",{className:"card-title",children:[(0,r.jsx)("i",{className:"fas fa-chart-line text-primary me-2"}),"\xbfQu\xe9 es el Historial de Predicciones?"]}),(0,r.jsxs)("p",{className:"card-text",children:["Esta secci\xf3n muestra ",(0,r.jsx)("strong",{children:"patrones hist\xf3ricos de tus gastos"})," organizados por categor\xeda. El sistema analiza autom\xe1ticamente tus gastos pasados para predecir tendencias futuras."]}),(0,r.jsxs)("div",{className:"row",children:[(0,r.jsxs)("div",{className:"col-md-6",children:[(0,r.jsx)("h6",{className:"text-primary",children:"\uD83D\uDCCA \xbfQu\xe9 informaci\xf3n encuentras aqu\xed?"}),(0,r.jsxs)("ul",{className:"small",children:[(0,r.jsxs)("li",{children:[(0,r.jsx)("strong",{children:"Montos predichos"})," por categor\xeda y mes"]}),(0,r.jsxs)("li",{children:[(0,r.jsx)("strong",{children:"Tendencias de gasto"})," a lo largo del tiempo"]}),(0,r.jsxs)("li",{children:[(0,r.jsx)("strong",{children:"Patrones estacionales"})," en tus finanzas"]}),(0,r.jsxs)("li",{children:[(0,r.jsx)("strong",{children:"Base para predicciones"})," del pr\xf3ximo mes"]})]})]}),(0,r.jsxs)("div",{className:"col-md-6",children:[(0,r.jsx)("h6",{className:"text-success",children:"\uD83C\uDFAF \xbfC\xf3mo usar esta informaci\xf3n?"}),(0,r.jsxs)("ul",{className:"small",children:[(0,r.jsxs)("li",{children:[(0,r.jsx)("strong",{children:"Planifica tu presupuesto"})," mensual"]}),(0,r.jsxs)("li",{children:[(0,r.jsx)("strong",{children:"Anticipa gastos"})," recurrentes"]}),(0,r.jsxs)("li",{children:[(0,r.jsx)("strong",{children:"Identifica categor\xedas"})," con mayor variaci\xf3n"]}),(0,r.jsxs)("li",{children:[(0,r.jsx)("strong",{children:"Mejora tu control"})," financiero"]})]})]})]}),(0,r.jsx)("div",{className:"alert alert-info mt-3 mb-0",children:(0,r.jsxs)("small",{children:[(0,r.jsx)("i",{className:"fas fa-info-circle me-2"}),(0,r.jsx)("strong",{children:"Nota:"})," Los datos se actualizan autom\xe1ticamente cada vez que registras un pago. El sistema utiliza un promedio m\xf3vil de los \xfaltimos 6 meses para las predicciones."]})})]})}),(0,r.jsx)("div",{className:"card mb-4",children:(0,r.jsx)("div",{className:"card-body",children:(0,r.jsxs)("div",{className:"row",children:[(0,r.jsxs)("div",{className:"col-md-4",children:[(0,r.jsx)("label",{htmlFor:"filtroMes",className:"form-label",children:"Filtrar por Mes"}),(0,r.jsxs)("select",{id:"filtroMes",className:"form-select",value:o,onChange:e=>d(e.target.value),children:[(0,r.jsx)("option",{value:"",children:"Todos los meses"}),j.map(e=>(0,r.jsx)("option",{value:e,children:new Date(2e3,e-1).toLocaleString("es-AR",{month:"long"})},e))]})]}),(0,r.jsxs)("div",{className:"col-md-4",children:[(0,r.jsx)("label",{htmlFor:"filtroA\xf1o",className:"form-label",children:"Filtrar por A\xf1o"}),(0,r.jsxs)("select",{id:"filtroA\xf1o",className:"form-select",value:m,onChange:e=>x(e.target.value),children:[(0,r.jsx)("option",{value:"",children:"Todos los a\xf1os"}),h.map(e=>(0,r.jsx)("option",{value:e,children:e},e))]})]}),(0,r.jsx)("div",{className:"col-md-4 d-flex align-items-end",children:(0,r.jsxs)("button",{className:"btn btn-outline-secondary w-100",onClick:()=>{d(""),x("")},children:[(0,r.jsx)("i",{className:"fas fa-times me-2"}),"Limpiar Filtros"]})})]})})}),f.length>0&&(0,r.jsxs)("div",{className:"card mb-4",children:[(0,r.jsx)("div",{className:"card-header",children:(0,r.jsxs)("h5",{className:"card-title mb-0",children:[(0,r.jsx)("i",{className:"fas fa-chart-bar me-2"}),"Resumen Mensual de Predicciones"]})}),(0,r.jsx)("div",{className:"card-body",children:(0,r.jsx)("div",{className:"row",children:f.slice(0,6).map(e=>(0,r.jsx)("div",{className:"col-md-4 col-lg-2 mb-3",children:(0,r.jsx)("div",{className:"card bg-primary text-white text-center",children:(0,r.jsxs)("div",{className:"card-body p-3",children:[(0,r.jsxs)("h6",{className:"card-title mb-1 small",children:[e.nombre_mes.trim()," ",e.año]}),(0,r.jsx)("p",{className:"card-text h6 mb-0",children:formatCurrency(e.total_predicho)}),(0,r.jsxs)("small",{className:"opacity-75",children:[e.categorias.length," categor\xedas"]})]})})},"".concat(e.año,"-").concat(e.mes)))})})]}),(0,r.jsx)("div",{className:"card",children:(0,r.jsx)("div",{className:"card-body",children:a?(0,r.jsx)("div",{className:"text-center py-4",children:(0,r.jsx)("div",{className:"spinner-border text-primary",role:"status",children:(0,r.jsx)("span",{className:"visually-hidden",children:"Cargando..."})})}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("div",{className:"table-responsive",children:(0,r.jsxs)("table",{className:"table table-hover",children:[(0,r.jsx)("thead",{children:(0,r.jsxs)("tr",{children:[(0,r.jsx)("th",{children:"Mes/A\xf1o"}),(0,r.jsx)("th",{children:"Categor\xeda"}),(0,r.jsx)("th",{children:"Monto Predicho"}),(0,r.jsx)("th",{children:"Variaci\xf3n"})]})}),(0,r.jsx)("tbody",{children:e.map(e=>(0,r.jsxs)("tr",{children:[(0,r.jsx)("td",{children:(0,r.jsxs)("strong",{children:[e.nombre_mes.trim()," ",e.año]})}),(0,r.jsx)("td",{children:(0,r.jsx)("span",{className:"badge bg-info text-capitalize",children:e.categoria})}),(0,r.jsx)("td",{className:"fw-bold text-primary",children:formatCurrency(parseMontoPredicho(e.monto_predicho))}),(0,r.jsx)("td",{children:(0,r.jsxs)("span",{className:"badge bg-success",children:[(0,r.jsx)("i",{className:"fas fa-chart-line me-1"}),"Tendencia"]})})]},e.id_historial))})]})}),0===e.length&&(0,r.jsxs)("div",{className:"text-center py-5 text-muted",children:[(0,r.jsx)("i",{className:"fas fa-chart-line fa-3x mb-3"}),(0,r.jsx)("p",{children:o||m?"No hay datos de predicci\xf3n para los filtros aplicados":"No hay historial de predicciones disponible"}),(0,r.jsx)("small",{children:"El historial se generar\xe1 autom\xe1ticamente a medida que registres pagos en el sistema."})]})]})})})]}),(0,r.jsx)(t.Z,{})]})]})}}},function(e){e.O(0,[412,517,971,472,744],function(){return e(e.s=3186)}),_N_E=e.O()}]);